<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>INSPINIA | Dashboard v.3</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

    <!-- Morris -->
    <link href="css/plugins/morris/morris-0.4.3.min.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/plugins/iCheck/custom.css" rel="stylesheet">

    <style type="text/css">
        #btn-new-metric {
            margin-left: 10px;
            margin-right: 10px;
            color: white;
        }

        .btn-edit-KPI {
            position: absolute;
            top: 10px;
            right: 25px;
        }
    </style>
</head>

<body class="fixed-navigation">
    <div id="wrapper">
    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element"> <span>
                            <img alt="image" class="img-circle" src="img/profile_small.jpg" />
                             </span>
                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                            <span class="clear"> <span class="block m-t-xs"> <strong class="user-name font-bold">David Williams</strong>
                             </span> <span class="text-muted text-xs block">Perfil <b class="caret"></b></span> </span> </a>
                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                            <li><a href="profile.html">Profile</a></li>
                            <li><a href="contacts.html">Contacts</a></li>
                            <li><a href="mailbox.html">Mailbox</a></li>
                            <li class="divider"></li>
                            <li><a href="login.html">Logout</a></li>
                        </ul>
                    </div>
                    <div class="logo-element">
                        IN+
                    </div>
                </li>
                <li><a id="btn-new-metric" href="#" class="btn btn-primary"><i class="fa fa-print"></i> Nova Métrica</a></li>
                <li><button id="btn-test">Test</button></li>
                <li class="kpi-name-option">
                    <a href="#"><i class="fa fa-pie-chart"></i> <span class="kpi-label nav-label">Todos</span></a>
                </li>
            </ul>
        </div>
    </nav>

        <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
        <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
            <form role="search" class="navbar-form-custom" action="search_results.html">
                <div class="form-group">
                    <input type="text" placeholder="Search for something..." class="form-control" name="top-search" id="top-search">
                </div>
            </form>
        </div>
            <ul class="nav navbar-top-links navbar-right">
                <li>
                    <span class="m-r-sm text-muted welcome-message">Welcome to INSPINIA+ Admin Theme.</span>
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                        <i class="fa fa-envelope"></i>  <span class="label label-warning">16</span>
                    </a>
                    <ul class="dropdown-menu dropdown-messages">
                        <li>
                            <div class="dropdown-messages-box">
                                <a href="profile.html" class="pull-left">
                                    <img alt="image" class="img-circle" src="img/a7.jpg">
                                </a>
                                <div>
                                    <small class="pull-right">46h ago</small>
                                    <strong>Mike Loreipsum</strong> started following <strong>Monica Smith</strong>. <br>
                                    <small class="text-muted">3 days ago at 7:58 pm - 10.06.2014</small>
                                </div>
                            </div>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <div class="dropdown-messages-box">
                                <a href="profile.html" class="pull-left">
                                    <img alt="image" class="img-circle" src="img/a4.jpg">
                                </a>
                                <div>
                                    <small class="pull-right text-navy">5h ago</small>
                                    <strong>Chris Johnatan Overtunk</strong> started following <strong>Monica Smith</strong>. <br>
                                    <small class="text-muted">Yesterday 1:21 pm - 11.06.2014</small>
                                </div>
                            </div>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <div class="dropdown-messages-box">
                                <a href="profile.html" class="pull-left">
                                    <img alt="image" class="img-circle" src="img/profile.jpg">
                                </a>
                                <div>
                                    <small class="pull-right">23h ago</small>
                                    <strong>Monica Smith</strong> love <strong>Kim Smith</strong>. <br>
                                    <small class="text-muted">2 days ago at 2:30 am - 11.06.2014</small>
                                </div>
                            </div>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <div class="text-center link-block">
                                <a href="mailbox.html">
                                    <i class="fa fa-envelope"></i> <strong>Read All Messages</strong>
                                </a>
                            </div>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                        <i class="fa fa-bell"></i>  <span class="label label-primary">8</span>
                    </a>
                    <ul class="dropdown-menu dropdown-alerts">
                        <li>
                            <a href="mailbox.html">
                                <div>
                                    <i class="fa fa-envelope fa-fw"></i> You have 16 messages
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="profile.html">
                                <div>
                                    <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                    <span class="pull-right text-muted small">12 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="grid_options.html">
                                <div>
                                    <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                    <span class="pull-right text-muted small">4 minutes ago</span>
                                </div>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <div class="text-center link-block">
                                <a href="notifications.html">
                                    <strong>See All Alerts</strong>
                                    <i class="fa fa-angle-right"></i>
                                </a>
                            </div>
                        </li>
                    </ul>
                </li>


                <li>
                    <a href="login.html">
                        <i class="fa fa-sign-out"></i> Log out
                    </a>
                </li>
                <li>
                    <a class="right-sidebar-toggle">
                        <i class="fa fa-tasks"></i>
                    </a>
                </li>
            </ul>

        </nav>
        </div>
            <div class="wrapper wrapper-content">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox-title" style="height: 70px;">
                            <h5 style="width:70%"><span id="KPI-metric-name">TDOTC</span> - <span id="KPI-metric-description">Taxa de demanda de ocupação do coworking (%) das horas disponibilizadas, por times empreendedores que utilizam tecnologia do portfolio de inovação.</span></h5>
                            <div class="pull-right">
                                <div class="btn-group">
                                    <!-- <button type="button" class="btn btn-xs btn-white active">Hoje</button> -->
                                    <button id="btn-show-KPI-timeline-daily" type="button" class="btn-show-timeline-daily btn btn-xs btn-white">Diária</button>
                                    <button id="btn-show-KPI-timeline-weekly" type="button" class="btn-show-timeline-weekly btn btn-xs btn-white">Semanal</button>
                                    <button id="btn-show-KPI-timeline-monthly" type="button" class="btn-show-timeline-monthly btn btn-xs btn-white">Mensal</button>
                                    <!-- <button type="button" class="btn btn-xs btn-white">Anual</button> -->
                                </div>
                            </div>                                                        
                        </div>

                        <div class="ibox float-e-margins">
                            <div class="ibox-content">
                                <div>
                                    <canvas id="lineChart" height="70"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col-lg-4">
                        <div class="ibox">
                            <div class="ibox-content" style="height:115px;">
                                <h5>Meta Diária</h5>
                                <a class="btn-edit-KPI"><span class="fa fa-edit"></span></a>
                                <h1 class="no-margins" style="text-align:center;"><span id="KPI-current-daily-goal">30</span></h1>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="ibox">
                            <div class="ibox-content" style="height:115px;">
                                <h5>Meta Semanal</h5>
                                <a class="btn-edit-KPI"><span class="fa fa-edit"></span></a>
                                <h1 class="no-margins" style="text-align:center;"><span id="KPI-current-weekly-goal">30</span></h1>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="ibox">
                            <div class="ibox-content" style="height:115px;">
                                <h5>Meta Mensal</h5>
                                <a class="btn-edit-KPI"><span class="fa fa-edit"></span></a>
                                <h1 class="no-margins" style="text-align:center;"><span id="KPI-current-monthly-goal">30</span></h1>
                            </div>
                        </div>
                    </div>
<!--                     <div class="col-lg-4">
                        <div class="ibox">
                            <div class="ibox-content" style="height:115px;">
                                <h5>Meta Anual</h5>
                                <h1 class="no-margins" style="text-align:center;"><span id="KPI-goal-value">30</span></h1>
                            </div>
                        </div>
                    </div>
 -->
                    <div class="col-lg-4">
                        <div class="ibox">
                            <div class="ibox-content">
                                <h5>Valor diário atual</h5>
                                <h1 class="no-margins"><span id="KPI-current-daily-value">30%</span></h1>
                                <div class="stat-percent font-bold text-navy"><span id="KPI-previous-daily-value">40%</span> <i class="fa fa-bolt"></i></div>
                                <small>Valor anterior e tendência</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="ibox">
                            <div class="ibox-content">
                                <h5>Valor semanal atual</h5>
                                <h1 class="no-margins"><span id="KPI-current-weekly-value">30%</span></h1>
                                <div class="stat-percent font-bold text-navy"><span id="KPI-previous-weekly-value">40%</span> <i class="fa fa-bolt"></i></div>
                                <small>Valor anterior e tendência</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="ibox">
                            <div class="ibox-content">
                                <h5>Valor mensal atual</h5>
                                <h1 class="no-margins"><span id="KPI-current-monthly-value">40%</span></h1>
                                <div class="stat-percent font-bold text-navy"><span id="KPI-previous-monthly-value">40%</span> <i class="fa fa-bolt"></i></div>
                                <small>Valor anterior e tendência</small>
                            </div>
                        </div>
                    </div>
<!--                     <div class="col-lg-4">
                        <div class="ibox">
                            <div class="ibox-content">
                                <h5>Valor anual atual</h5>
                                <h1 class="no-margins">30%</h1>
                                <div class="stat-percent font-bold text-navy">40% <i class="fa fa-bolt"></i></div>
                                <small>Valor anterior e tendência</small>
                            </div>
                        </div>
                    </div> -->
                </div>
            </div>
        <div class="footer">
            <div class="pull-right">
                10GB of <strong>250GB</strong> Free.
            </div>
            <div>
                <strong>Copyright</strong> Example Company &copy; 2014-2015
            </div>
        </div>

        </div>

    <div class="modal inmodal" id="edit-KPI-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Editar Metas</h4>
                </div>
                <div class="modal-body">
                    <div class="ibox-content">
                        <div class="row">
                            <h3><span class="KPI-name"></span> - <span class="KPI-description"></span></h3>
                            <div class="col-sm-12 b-r">
                                <form role="form">
                                    <div class="form-group"><label>Meta diária</label> <input id="input-new-daily-goal" type="text" placeholder="0" class="form-control"></div>
                                    <div class="form-group"><label>Meta semanal</label> <input id="input-new-weekly-goal" type="text" placeholder="0" class="form-control"></div>
                                    <div class="form-group"><label>Meta mensal</label> <input id="input-new-monthly-goal" type="text" placeholder="0" class="form-control"></div>
                                <div class="form-group">
                                        <div class="i-checks"><label class=""> <div class="icheckbox_square-green" style="position: relative;"><input type="checkbox" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div><i></i> métrica é medida em percentual</label></div>
                                </div> 
                                </form>
                            </div>
                        </div>
                    </div>                
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Fechar</button>
                    <button id="btn-save-new-goals" type="button" class="btn btn-primary">Alterar metas</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal inmodal" id="new-KPI-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content animated">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">Criar uma nova métrica</h4>
                </div>
                <div class="modal-body">
                    <div class="ibox-content">
                        <div class="row">
                            <h3>Crie uma nova métrica</h3>
                            <div class="col-sm-12 b-r">
                                <form role="form">
                                    <div class="form-group"><label>Nome</label> <input id="input-new-metric-name" type="text" placeholder="nome da métrica" class="form-control"></div>
                                    <div class="form-group"><label>Descrição</label> <input id="input-new-metric-description" type="text" placeholder="descrição da métrica" class="form-control"></div>
                                <div class="form-group">
                                        <div class="i-checks"><label class=""> <div class="icheckbox_square-green" style="position: relative;"><input type="checkbox" style="position: absolute; opacity: 0;"><ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; border: 0px; opacity: 0; background: rgb(255, 255, 255);"></ins></div><i></i> métrica é medida em percentual</label></div>
                                </div> 
                                </form>
                            </div>
                        </div>
                    </div>                
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">cancelar</button>
                    <button id="btn-create-new-metric" type="button" class="btn btn-primary">criar métrica</button>
                </div>
            </div>
        </div>
    </div>

    </div>


    <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.js"></script>

    <script type="text/javascript">
        $kpiNameOptionRef = $('.kpi-name-option').detach()
    </script>

    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Flot -->
    <script src="js/plugins/flot/jquery.flot.js"></script>
    <script src="js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="js/plugins/flot/jquery.flot.spline.js"></script>
    <script src="js/plugins/flot/jquery.flot.resize.js"></script>
    <script src="js/plugins/flot/jquery.flot.pie.js"></script>
    <script src="js/plugins/flot/jquery.flot.symbol.js"></script>
    <script src="js/plugins/flot/curvedLines.js"></script>

    <!-- Peity -->
    <script src="js/plugins/peity/jquery.peity.min.js"></script>
    <script src="js/demo/peity-demo.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- jQuery UI -->
    <script src="js/plugins/jquery-ui/jquery-ui.min.js"></script>

    <!-- Jvectormap -->
    <script src="js/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
    <script src="js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>

    <!-- Sparkline -->
    <script src="js/plugins/sparkline/jquery.sparkline.min.js"></script>

    <!-- Sparkline demo data  -->
    <script src="js/demo/sparkline-demo.js"></script>

    <!-- ChartJS-->
    <script src="js/plugins/chartJs/Chart.min.js"></script>

    <script src="js/plugins/iCheck/icheck.min.js"></script>

    <!-- MomentJS -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>

    <script>

        var dailyGoal = 0
        var weeklyGoal = 0
        var monthlyGoal = 0

        var lineData = {
            labels: [],
            datasets: [
                {
                    label: "Example dataset",
                    fillColor: "rgba(220,220,220,0.5)",
                    strokeColor: "rgba(220,220,220,1)",
                    pointColor: "rgba(220,220,220,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(220,220,220,1)",
                    data: []
                },
                {
                    label: "Example dataset",
                    fillColor: "rgba(26,179,148,0.5)",
                    strokeColor: "rgba(26,179,148,0.7)",
                    pointColor: "rgba(26,179,148,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(26,179,148,1)",
                    data: []
                }
            ]
        };

        var lineOptions = {
            scaleShowGridLines: true,
            scaleGridLineColor: "rgba(0,0,0,.05)",
            scaleGridLineWidth: 1,
            bezierCurve: true,
            bezierCurveTension: 0.4,
            pointDot: true,
            pointDotRadius: 4,
            pointDotStrokeWidth: 1,
            pointHitDetectionRadius: 20,
            datasetStroke: true,
            datasetStrokeWidth: 2,
            datasetFill: true,
            responsive: true,
        };

        $(document).ready(function() {
            $('.i-checks').iCheck({
                    checkboxClass: 'icheckbox_square-green',
                    radioClass: 'iradio_square-green',
            });

            $('input').on('ifChecked', function(ev) {
                setMetricToPercentage()
            })

            $('input').on('ifUnchecked', function(ev) {
                unsetMetricToPercentage()
            })            
        });

        $(document).ready(function() {
            // setup();

            firebase.auth().onAuthStateChanged(function(user) {
              if (user) {
                // User is signed in.
                $('#btn-new-metric').click(function() {
                    $('#new-KPI-modal').modal('show')
                })
                showUserName(user.email)
              } else {
                // No user is signed in.
              }
            });            

            $('#btn-test').click(function() {
                test()
            })

            $('#btn-show-KPI-timeline-daily').click(function() {
                showMetricTimelineDaily();
            })

            $('#btn-show-KPI-timeline-weekly').click(function() {
                selectedMetric['timeline'] = 'week'
                calcMetricWeekly().then(function() {
                    showSelectedMetric()
                    showMetricTimelineWeekly()
                })
            })

            $('#btn-show-KPI-timeline-monthly').click(function() {
                showMetricTimelineMonthly(selectedMetric['name']);
            })

            $('.btn-edit-KPI').click(function() {
                $('#edit-KPI-modal').modal('show')
            })

            $('#btn-create-new-metric').click(function() {
                var name = $('#input-new-metric-name').val().trim()
                var description = $('#input-new-metric-description').val().trim()

                var newMetric = {name: name, Description: description, isPercent: false}

                var newMetricKey = firebase.database().ref('/Offers/KPIs/Coworking/').child('Acquisition').push().key;

                updates = {}
                updates['/Offers/Coworking/KPIs/Acquisition/' + newMetricKey] = newMetric
                updates['/KPIs/Coworking/Acquisition/' + newMetricKey] = {
                    name: name,
                    currentGoalsAndValues: {
                        goals: {
                            dailyGoal: 0,
                            weeklyGoal:0,
                            monthlyGoal:0
                        },
                        values: {
                            dailyValue: 0,
                            weeklyValue:0,
                            monthlyValue:0,                            
                            previousDailyValue: 0,
                            previousWeeklyValue:0,
                            previousMonthlyValue:0                            
                        }
                    }
                }

                firebase.database().ref().update(updates).then(function() {
                    $('#new-KPI-modal').modal('hide')
                    selectMetric(newMetricKey)
                })
            })

            $('#btn-save-new-goals').click(function() {
                $('#input-new-daily-goal').attr('disabled', 'true')
                $('#input-new-weekly-goal').attr('disabled', 'true')
                $('#input-new-monthly-goal').attr('disabled', 'true')
                $('.i-checks').iCheck('disable')
                var newDailyGoal = $('#input-new-daily-goal').val().trim()
                var newWeeklyGoal = $('#input-new-weekly-goal').val().trim()
                var newMonthlyGoal = $('#input-new-monthly-goal').val().trim()

                updateMetricGoals(selectedMetric['name'], newDailyGoal, newWeeklyGoal, newMonthlyGoal, selectedMetric['isPercent']).then(function() {
                    $('#input-new-daily-goal').removeAttr('disabled')
                    $('#input-new-weekly-goal').removeAttr('disabled')
                    $('#input-new-monthly-goal').removeAttr('disabled')
                    $('.i-checks').iCheck('enable')
                    $('#edit-KPI-modal').modal('hide')
                })
            })

        });
    </script>

    <script type="text/javascript">
        var myNewChart

        function showUserName(userName) {
            $('.user-name').text(userName)
        }

        function setMetricToPercentage() {
            selectedMetric['isPercent'] = true
        }

        function unsetMetricToPercentage() {
            selectedMetric['isPercent'] = false
        }

        function updateMetricGoals(kpiName, dailyGoal, weeklyGoal, monthlyGoal, isPercent) {
            var updates = {}
            updates['/KPIs/Coworking/Acquisition/' + kpiName + '/currentGoalsAndValues/goals/dailyGoal'] = Number(dailyGoal)
            updates['/KPIs/Coworking/Acquisition/' + kpiName + '/currentGoalsAndValues/goals/weeklyGoal'] = Number(weeklyGoal)
            updates['/KPIs/Coworking/Acquisition/' + kpiName + '/currentGoalsAndValues/goals/monthlyGoal'] = Number(monthlyGoal)
            updates['/Offers/Coworking/KPIs/Acquisition/' + kpiName + '/isPercent/'] = isPercent

            return firebase.database().ref().update(updates)
        }   

        function showSelectedMetric() {
            var percentSymbol = ''
            if (selectedMetric['isPercent']) {
                percentSymbol = ' %'
            }

            $('#KPI-current-daily-value').text(selectedMetric['dailyValue'] + percentSymbol)
            $('#KPI-current-weekly-value').text(selectedMetric['weeklyValue'] + percentSymbol)
            $('#KPI-current-monthly-value').text(selectedMetric['monthlyValue'] + percentSymbol)

            $('#KPI-previous-daily-value').text(selectedMetric['previousDailyValue'] + percentSymbol)
            $('#KPI-previous-weekly-value').text(selectedMetric['previousWeeklyValue'] + percentSymbol)
            $('#KPI-previous-monthly-value').text(selectedMetric['previousMonthlyValue'] + percentSymbol)

            $('#KPI-current-daily-goal').text(selectedMetric['dailyGoal'] + percentSymbol)
            $('#KPI-current-weekly-goal').text(selectedMetric['weeklyGoal'] + percentSymbol)
            $('#KPI-current-monthly-goal').text(selectedMetric['monthlyGoal'] + percentSymbol)

            $('#input-new-daily-goal').val(selectedMetric['dailyGoal'])
            $('#input-new-weekly-goal').val(selectedMetric['weeklyGoal'])
            $('#input-new-monthly-goal').val(selectedMetric['monthlyGoal'])
        }        

        function showMetricDescription(kpiName, newVal) {
            $('#' + kpiName + '-metric-description').text(newVal);
        }

        function showMetricTimelineMonthly() {
            lineData['labels'] = []
            lineData['datasets'][0]['data'] = []
            lineData['datasets'][1]['data'] = []

            for (month in selectedMetric['months']) {
                var val = selectedMetric['months'][month];
                startMonthDay = moment(val['start'])
                endMonthDay = moment(startMonthDay).endOf('month')
                goal = selectedMetric['monthlyGoal']
                value = val['value']
    
                lineData['labels'].push(startMonthDay.format('MMM'))
                lineData['datasets'][0]['data'].push(goal)
                lineData['datasets'][1]['data'].push(value)
            }
    
            if (myNewChart) {
                myNewChart.destroy()
            }
            var ctx = document.getElementById("lineChart").getContext("2d");
            myNewChart = new Chart(ctx).Line(lineData, lineOptions);
        }

        function showMetricTimelineWeekly() {
            lineData['labels'] = []
            lineData['datasets'][0]['data'] = []
            lineData['datasets'][1]['data'] = []

            for (week in selectedMetric['weeks']) {
                var val = selectedMetric['weeks'][week];
                startWeekDay = moment(val['start'])
                endWeekDay = moment(startWeekDay).add(6, 'Days')
                goal = selectedMetric['weeklyGoal']
                value = val['value']
    
                lineData['labels'].push(startWeekDay.format('DD/MM') + ' - ' + endWeekDay.format('DD/MM'))
                lineData['datasets'][0]['data'].push(goal)
                lineData['datasets'][1]['data'].push(value)
            }
    
            if (myNewChart) {
                myNewChart.destroy()
            }
            var ctx = document.getElementById("lineChart").getContext("2d");
            myNewChart = new Chart(ctx).Line(lineData, lineOptions);
        }

        function showMetricTimelineDaily() {
            lineData['labels'] = []
            lineData['datasets'][0]['data'] = []
            lineData['datasets'][1]['data'] = []

            for (day in selectedMetric['days']) {
                    var val = selectedMetric['days'][day]
                    day = val['day']
                    goal = selectedMetric['dailyGoal']
                    value = val['value']
        
                    values = lineData['datasets'][1]['data']
                    labels = lineData['labels']
                    label = moment(day).format('DD/MM')

                    lineData['labels'].push(label)

                    lineData['datasets'][0]['data'].push(goal)
                    lineData['datasets'][1]['data'].push(value)
            }
            var ctx = document.getElementById("lineChart").getContext("2d");
            if (myNewChart) {
                myNewChart.destroy()
            }
            myNewChart = new Chart(ctx).Line(lineData, lineOptions);
        }

        function initializeGoals() {
            var updates = {}
            selectedMetric['dailyGoal'] = 0
            selectedMetric['weeklyGoal'] = 0
            selectedMetric['monthlyGoal'] = 0
            selectedMetric['isPercent'] = true

            updates['/KPIs/Coworking/Acquisition/' + selectedMetric['id'] + '/name/'] = selectedMetric['name']
            updates['/KPIs/Coworking/Acquisition/' + selectedMetric['id'] + '/currentGoalsAndValues/goals/'] = {dailyGoal: 0, weeklyGoal:0, monthlyGoal:0}
            updates['/KPIs/Coworking/Acquisition/' + selectedMetric['id'] + '/currentGoalsAndValues/values/'] = {dailyValue: 0, previousDailyValue: 0, weeklyValue: 0, previousWeeklyValue: 0, monthlyValue: 0, previousMonthlyValue: 0}
            return firebase.database().ref().update(updates)
        }



        function selectMetric(metricID) {
            //Se houver uma mudança nas KPIs 
            if (selectedMetric) {
                firebase.database().ref('/Offers/Coworking/KPIs/Acquisition' + selectedMetric['name']).off()
            }

            selectedMetric = {
                id: '',
                timeline: 'day',
                name: '',
                description: '',
                isPercent: false,
                dailyGoal: 0,
                weeklyGoal: 0,
                monthlyGoal: 0,
                dailyValue:0,
                weeklyValue:0,
                monthlyValue:0,
                days: {},
                weeks: {},
                months: {}            
            }
            selectedMetric['id'] = metricID
            selectedMetric['name'] = coworkingAcquisitionMetrics[metricID]['name']
            selectedMetric['description'] = coworkingAcquisitionMetrics[metricID]['Description']
            selectedMetric['isPercent'] = coworkingAcquisitionMetrics[metricID]['isPercent']

            firebase.database().ref('/Offers/Coworking/KPIs/Acquisition/' + selectedMetric['id']).on('value', function(snapshot) {
                val = snapshot.val();
                selectedMetric['description'] = val['Description']
                showMetricDescription(selectedMetric['id'], val['Description']);
            })

            //setup weeks beginning on Jun 01 2016
            beginDate = moment().startOf('month')
            finalDate = moment().startOf('month').add(1, 'Months')

            startWeek = moment(beginDate).startOf('week')
            endWeek = moment(finalDate).endOf('week')
            durationDays = Math.round(moment.duration(endWeek - startWeek).asDays())
            durationWeeks = Math.round(moment.duration(endWeek - startWeek).asWeeks())

            periodRef = firebase.database().ref('/Coworking/Acquisition/Days/').orderByChild('day').limitToFirst(durationDays)


            $('#KPI-metric-name').text(selectedMetric['name'])
            $('#KPI-metric-description').text(selectedMetric['description'])                

            firebase.database().ref('/KPIs/Coworking/Acquisition/' + selectedMetric[
                 'id'] + '/currentGoalsAndValues/goals').on('value', function(snapshot) {
                var currentGoals = snapshot.val()
                selectedMetric['dailyGoal'] = currentGoals['dailyGoal']
                selectedMetric['weeklyGoal'] = currentGoals['weeklyGoal']
                selectedMetric['monthlyGoal'] = currentGoals['monthlyGoal']

                if (selectedMetric['timeline'] == 'day') {
                    showSelectedMetric()
                    showMetricTimelineDaily()
                }else if (selectedMetric['timeline'] == 'week') {
                    showSelectedMetric()
                    showMetricTimelineWeek()
                }else if (selectedMetric['timeline'] == 'month') {
                    showSelectedMetric()                    
                    // showMetricTimelineMonthly()
                }
            })

            firebase.database().ref('/KPIs/Coworking/Acquisition/' + selectedMetric['id'] + '/currentGoalsAndValues/').once('value', function(snapshot) {

                var currentGoalsAndValues = snapshot.val()
                currentGoals = currentGoalsAndValues['goals']
                currentValues = currentGoalsAndValues['values']

                // selectedMetric['dailyValue'] = currentValues['dailyValue']
                // selectedMetric['weeklyValue'] = currentValues['weeklyValue']
                // selectedMetric['monthlyValue'] = currentValues['monthlyValue']

                selectedMetric['dailyGoal'] = currentGoals['dailyGoal']
                selectedMetric['weeklyGoal'] = currentGoals['weeklyGoal']
                selectedMetric['monthlyGoal'] = currentGoals['monthlyGoal']

                if (selectedMetric['timeline'] == 'day') {
                    calcMetricDaily().then(function() {
                        showSelectedMetric()
                        showMetricTimelineDaily();
                    });
                }else if (selectedMetric['timeline'] == 'week') {
                    calcMetricDWeekly().then(function() {
                        showSelectedMetric()
                        showMetricTimelineWeekly();
                    });                    
                }

            })
        }
    </script>
    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
    <script>
        var weeklyDemands = []

        var coworkingAcquisitionMetrics = {}

        var selectedMetric = null

        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyD0jgyMEgjNXHNN95sbf-i0Xxzo9QybHxI",
            authDomain: "midyear-castle-816.firebaseapp.com",
            databaseURL: "https://midyear-castle-816.firebaseio.com",
            storageBucket: "midyear-castle-816.appspot.com",
        };
        var mainApp = firebase.initializeApp(config);        

        kpisRef = firebase.database().ref('/Offers/Coworking/KPIs/Acquisition/');        

        kpisRef.on('child_added', function(snapshot) {
            coworkingAcquisitionMetrics[snapshot.key] = snapshot.val()
            var metricID = snapshot.key
            var kpiName = snapshot.val()['name']

            kpiDescription = snapshot.val()['Description']
            $kpiNameOption = $kpiNameOptionRef.clone()
            $kpiNameOption.find('.kpi-label').text(kpiName)
            $kpiNameOption.find('a').addClass(kpiName + '-kpi-link')
            $kpiNameOption.appendTo($('#side-menu'))            

            $('.' + kpiName + '-kpi-link').click(function() {
                selectMetric(metricID)
            })
        })

        function updateSelectedMetric() {
            var updates = {}

            updates['/KPIs/Coworking/Acquisition/' + selectedMetric['id'] + '/currentGoalsAndValues/values/dailyValue'] = selectedMetric['dailyValue']
            updates['/KPIs/Coworking/Acquisition/' + selectedMetric['id'] + '/currentGoalsAndValues/values/weeklyValue'] = selectedMetric['weeklyValue']
            updates['/KPIs/Coworking/Acquisition/' + selectedMetric['id'] + '/currentGoalsAndValues/values/monthlyValue'] = selectedMetric['monthlyValue']
            updates['/KPIs/Coworking/Acquisition/' + selectedMetric['id'] + '/currentGoalsAndValues/values/previousDailyValue'] = selectedMetric['previousDailyValue']
            updates['/KPIs/Coworking/Acquisition/' + selectedMetric['id'] + '/currentGoalsAndValues/values/previousWeeklyValue'] = selectedMetric['previousWeeklyValue']
            updates['/KPIs/Coworking/Acquisition/' + selectedMetric['id'] + '/currentGoalsAndValues/values/previousMonthlyValue'] = selectedMetric['previousMonthlyValue']

            for (day in selectedMetric['days']) {
                updates['KPIs/Coworking/Acquisition/' + selectedMetric['id'] + day + '/value/'] = selectedMetric['days'][day]['value']
                updates['KPIs/Coworking/Acquisition/' + selectedMetric['id'] + day + '/goal'] = selectedMetric['dailyGoal']
                updates['KPIs/Coworking/Acquisition/' + selectedMetric['id'] + day + '/day'] = selectedMetric['days'][day]['day']
            }
            for (startWeekDay in selectedMetric['weeks']) {
                updates['KPIs/Coworking/Acquisition/' + selectedMetric['id'] + startWeekDay + '/value/'] = selectedMetric['weeks'][startWeekDay]['value']
                updates['KPIs/Coworking/Acquisition/' + selectedMetric['id'] + startWeekDay + '/goal'] = selectedMetric['weeklyGoal']
                updates['KPIs/Coworking/Acquisition/' + selectedMetric['id'] + startWeekDay + '/start'] = selectedMetric['weeks'][startWeekDay]['start']
            }
            for (startMonthDay in selectedMetric['months']) {
                updates['KPIs/Coworking/Acquisition/' + selectedMetric['id'] + startMonthDay + '/value/'] = selectedMetric['months'][startMonthDay]['value']
                updates['KPIs/Coworking/Acquisition/' + selectedMetric['id'] + startMonthDay + '/goal'] = selectedMetric['monthlyGoal']
                updates['KPIs/Coworking/Acquisition/' + selectedMetric['id'] + startMonthDay + '/start'] = selectedMetric['months'][startMonthDay]['start']
            }

            return firebase.database().ref().update(updates)
        }

        function calcMetricDaily() {
            selectedMetric['dailyValue'] = 0
            selectedMetric['weeklyValue'] = 0
            selectedMetric['monthlyValue'] = 0

            selectedMetric['previousDailyValue'] = 0
            selectedMetric['previousWeeklyValue'] = 0
            selectedMetric['previousMonthlyValue'] = 0


            var previousDailyValue = 0
            var currentDailyValue = 0

            ref = firebase.database().ref('/Coworking/Acquisition/Days/').orderByChild('day').limitToLast(31)


            var dailyDemands = {}
            var promise = new Promise(function(resolve, reject) {
                ref.on('value', function(snapshot) {
                    selectedMetric['dailyValue'] = 0
                    selectedMetric['previousDailyValue'] = 0
                    selectedMetric['days'] = {}


                    var days = snapshot.val()
                    var lastDay = 0
                    var firstDay = 0

                    for (d in days) {
                        lastDay = days[d]['day']

                    }
                    firstDay = moment(lastDay).subtract(30, 'days').valueOf()
                    for (i = 0; i <= 30; i++) {
                        var day = moment(firstDay).add(i, 'days').valueOf()
                        switch (selectedMetric['name']) {
                            case ('DOT'): {                                
                                selectedMetric['days']['/days/' + day] = {day: day, value:0}
                                break
                            }
                        }
                    }
                    for (d in days) {
                        var day = days[d]['day']
                        if (day > firstDay) {
                            var numSeatsDemandedForDay = 0
                            // var startWeekDay = moment(day).startOf('week').valueOf()
                            // var startMonthDay = moment(day).startOf('month').valueOf()
                            var availability = days[d]['availability']
                            var schedules = days[d]['schedules']
                            for (schedule in schedules) {
                                var teamsDemandsForSchedule = schedules[schedule]
                                for (teamDemandForSchedule in teamsDemandsForSchedule) {
                                    numSeatsDemandedForDay += teamsDemandsForSchedule[teamDemandForSchedule]['seats']
                                }                             
                            }
                            switch (selectedMetric['name']) {
                                //AQUI DEFINIR COMO SÃO CALCULADAS AS MÉTRICAS
                                case ('DOT'): {
                                    // selectedMetric['days']
                                    selectedMetric['days']['/days/' + day]['value'] = numSeatsDemandedForDay
                                    selectedMetric['days']['/days/' + day]['day'] = day

                                    var previousDay = moment(day).subtract(1, 'days').valueOf()
                                    selectedMetric['previousDailyValue'] = selectedMetric['days']['/days/' + previousDay]['value']
                                    selectedMetric['dailyValue'] = numSeatsDemandedForDay
                                    break
                                }
                            }                            
                        }
                    }
                    updateSelectedMetric().then(function() {
                        resolve()
                    })
                })
            })

            return promise                            
        }

        function calcMetricWeekly() {
            selectedMetric['dailyValue'] = 0
            selectedMetric['weeklyValue'] = 0
            selectedMetric['monthlyValue'] = 0

            selectedMetric['previousDailyValue'] = 0
            selectedMetric['previousWeeklyValue'] = 0
            selectedMetric['previousMonthlyValue'] = 0


            var previousDailyValue = 0
            var currentDailyValue = 0

            ref = firebase.database().ref('/Coworking/Acquisition/Days/').orderByChild('day').limitToLast(31)


            var dailyDemands = {}
            var promise = new Promise(function(resolve, reject) {
                ref.on('value', function(snapshot) {
                    selectedMetric['dailyValue'] = 0
                    selectedMetric['previousDailyValue'] = 0
                    selectedMetric['weeks'] = {}


                    var days = snapshot.val()
                    var lastDay = 0
                    var firstDay = 0

                    for (d in days) {
                        lastDay = days[d]['day']

                    }
                    firstDay = moment(lastDay).startOf('week').subtract(4, 'weeks').valueOf()
                    lastDay = moment(lastDay).endOf('week')
                    var durationAsWeeks = Math.round(moment.duration(lastDay - firstDay).asWeeks())

                    for (i = 0; i < durationAsWeeks; i++) {
                        var startWeek = moment(firstDay).add(i, 'weeks').valueOf()
                        switch (selectedMetric['name']) {
                            case ('DOT'): {                                
                                selectedMetric['weeks']['/weeks/' + startWeek] = {start: startWeek, value:0}
                                break
                            }
                        }
                    }
                    for (d in days) {
                        var day = days[d]['day']
                        if (day > firstDay) {
                            var weekStartDay = moment(day).startOf('week').valueOf()
                            var previousWeekStartDay = moment(weekStartDay).subtract(1, 'weeks').valueOf()
                            var numSeatsDemandedForDay = 0
                            // var startWeekDay = moment(day).startOf('week').valueOf()
                            // var startMonthDay = moment(day).startOf('month').valueOf()
                            var availability = days[d]['availability']
                            var schedules = days[d]['schedules']
                            for (schedule in schedules) {
                                var teamsDemandsForSchedule = schedules[schedule]
                                for (teamDemandForSchedule in teamsDemandsForSchedule) {
                                    numSeatsDemandedForDay += teamsDemandsForSchedule[teamDemandForSchedule]['seats']
                                }                             
                            }
                            switch (selectedMetric['name']) {
                                //AQUI DEFINIR COMO SÃO CALCULADAS AS MÉTRICAS
                                case ('DOT'): {
                                    // selectedMetric['days']
                                    selectedMetric['weeks']['/weeks/' + weekStartDay]['value'] += numSeatsDemandedForDay
                                    // selectedMetric['weeks']['/weeks/' + weekStartDay]['day'] = day

                                    if (moment(day).startOf('week').valueOf() == weekStartDay.valueOf()) {
                                        selectedMetric['weeklyValue'] += numSeatsDemandedForDay
                                    }
                                    if (moment(day).startOf('week').valueOf() == previousWeekStartDay.valueOf()) {
                                        selectedMetric['previousWeeklyValue'] += numSeatsDemandedForDay
                                    }
                                    break
                                }
                            }                            
                        }
                    }
                    updateSelectedMetric().then(function() {
                        resolve()
                    })
                })
            })

            return promise                            
        }

        function calcMetric() {
            //Aqui fazer os calculos das métricas de aquisição do Coworking
            //setup weeks beginning on Jun 01 2016
            startDate = moment().startOf('month')
            finalDate = moment().startOf('month').add(1, 'Months')

            startWeek = moment(startDate).startOf('week')
            endWeek = moment(finalDate).endOf('week')

            var startMonth = moment(startDate).startOf('month').valueOf()
            var endMonth = moment(finalDate).endOf('month').valueOf()

            durationDays = Math.round(moment.duration(endWeek - startWeek).asDays())
            durationWeeks = Math.round(moment.duration(endWeek - startWeek).asWeeks())


            var durationAsDays = Math.round(moment.duration(endMonth - startDate).asDays())

            for (i = 0; i < durationAsDays; i++) {
                var day = moment(startDate).add(i, 'days').valueOf()
                selectedMetric['days']['/days/' + day] = {day: day, value:0}
            }

            var durationAsWeeks = Math.round(moment.duration(endWeek - startWeek).asWeeks())
            for (i = 0; i < durationAsWeeks; i++) {
                var day = moment(startWeek).add(i, 'weeks').valueOf()
                selectedMetric['weeks']['/weeks/' + day] = {start:day, value:0}
            }

            var durationAsMonths = Math.round(moment.duration(endMonth - startMonth).asMonths())
            for (i = 0; i < durationAsMonths; i++) {
                var day = moment(startMonth).add(i, 'months').valueOf()
                selectedMetric['months']['/months/' + day] = {start:day, value:0}
            }

            selectedMetric['dailyValue'] = 0
            selectedMetric['weeklyValue'] = 0
            selectedMetric['monthlyValue'] = 0

            selectedMetric['previousDailyValue'] = 0
            selectedMetric['previousWeeklyValue'] = 0
            selectedMetric['previousMonthlyValue'] = 0

            var today = moment().startOf('day')
            var yesterday = moment().startOf('day').add(-1, 'days')
            var weekStart = moment().startOf('week')
            var previousWeekStart = moment(weekStart).add(-1, 'weeks')
            var monthStart = moment().startOf('month')
            var previousMonthStart = moment(monthStart).add(-1, 'months')

            var previousDailyValue = 0
            var currentDailyValue = 0

            ref = firebase.database().ref('/Coworking/Acquisition/Days/').orderByChild('day').startAt(startDate.valueOf()).endAt(finalDate.valueOf())


            var dailyDemands = {}
            var promise = new Promise(function(resolve, reject) {
                ref.on('value', function(snapshot) {
                    var days = snapshot.val()

                    for (d in days) {
                        var numSeatsDemandedForDay = 0
                        var day = days[d]['day']
                        var startWeekDay = moment(day).startOf('week').valueOf()
                        var startMonthDay = moment(day).startOf('month').valueOf()
                        var availability = days[d]['availability']
                        var schedules = days[d]['schedules']
                        for (schedule in schedules) {
                            var teamsDemandsForSchedule = schedules[schedule]
                            for (teamDemandForSchedule in teamsDemandsForSchedule) {
                                numSeatsDemandedForDay += teamsDemandsForSchedule[teamDemandForSchedule]['seats']
                            }                             
                        }
                        switch (selectedMetric['name']) {
                            //AQUI DEFINIR COMO SÃO CALCULADAS AS MÉTRICAS
                            case ('DOT'): {
                                selectedMetric['days']
                                selectedMetric['days']['/days/' + day]['value'] = numSeatsDemandedForDay
                                selectedMetric['days']['/days/' + day]['day'] = day
                                selectedMetric['weeks']['/weeks/' + startWeekDay]['value'] += numSeatsDemandedForDay
                                selectedMetric['weeks']['/weeks/' + startWeekDay]['start'] = startWeekDay
                                selectedMetric['months']['/months/' + startMonthDay]['value'] += numSeatsDemandedForDay
                                selectedMetric['months']['/months/' + startMonthDay]['start'] = startMonthDay

                                if (moment(day).startOf('day').valueOf() == today.valueOf()) {
                                    currentDailyValue = numSeatsDemandedForDay
                                    selectedMetric['dailyValue'] = currentDailyValue
                                }
                                if (moment(day).startOf('day').valueOf() == yesterday.valueOf()) {
                                    previousDailyValue = numSeatsDemandedForDay
                                    selectedMetric['previousDailyValue'] = previousDailyValue
                                }
                                if (moment(day).startOf('week').valueOf() == weekStart.valueOf()) {
                                    selectedMetric['weeklyValue'] += numSeatsDemandedForDay
                                }
                                if (moment(day).startOf('week').valueOf() == previousWeekStart.valueOf()) {
                                    selectedMetric['previousWeeklyValue'] += numSeatsDemandedForDay
                                }

                                if (moment(day).startOf('month').valueOf() == monthStart.valueOf()) {
                                    selectedMetric['monthlyValue'] += numSeatsDemandedForDay
                                }
                                
                                if (moment(day).startOf('month').valueOf() == previousMonthStart.valueOf()) {
                                    selectedMetric['previousMonthlyValue'] += numSeatsDemandedForDay
                                }
                                
                                break
                            }
                        }
                    }
                    updateSelectedMetric().then(function() {
                        resolve()
                    })
                })
            })

            return promise                            
        }

    </script>

    <script type="text/javascript">
        function test() {
            entrepreneursDict = {}
            teamsDict = {}
            teamsList = []

            //setup weeks beginning on Jun 01 2016
            beginDate = moment().startOf('month')
            finalDate = moment().startOf('month').add(1, 'Months')

            startWeek = moment(beginDate).startOf('week')
            endWeek = moment(finalDate).endOf('week')
            durationDays = moment.duration(endWeek - startWeek).asDays() - 1

            entrepreneursRef = firebase.database().ref('/entrepreneurs')
            entrepreneursRef.on('value', function(snapshot) {
                entrepreneursDict = snapshot.val()

                teamsRef = firebase.database().ref('/teams')
                teamsRef.on('value', function(snapshot) {
                    teamsDict = snapshot.val()
                    for (team in teamsDict) {
                        teamsList.push(team)
                    }

                    numTimerIntervals = 10

                    availability = 96
                    numSeats = 4

                        daysToAdd = Math.round(Math.random() * durationDays)
                        console.log('>>> days to add: ' + daysToAdd)
                        teamIndex = Math.round(Math.random() * 10)

                        hoursToAdd = Math.round(Math.random() * 9)
                        var newDay = moment(startWeek).add(daysToAdd, 'days').valueOf()
                        // var newDay = 1464750000000
                        hourScheduled = moment(newDay).add(8 + hoursToAdd, 'hours').valueOf()

                        updates = {}
                        updates['/Coworking/Acquisition/Days/' + newDay + '/availability'] = 96
                        updates['/Coworking/Acquisition/Days/' + newDay + '/day/'] = newDay
                        updates['/Coworking/Acquisition/Days/' + newDay + '/schedules/'  + hourScheduled + '/' + teamsList[teamIndex] + '/seats/'] = 4

                        firebase.database().ref().update(updates)
                })
            })
        }

        function setup () {
            entrepreneursDict = {}
            teamsDict = {}
            teamsList = []

            entrepreneursRef = firebase.database().ref('/entrepreneurs')
            entrepreneursRef.on('value', function(snapshot) {
                entrepreneursDict = snapshot.val()

                teamsRef = firebase.database().ref('/teams')
                teamsRef.on('value', function(snapshot) {
                    teamsDict = snapshot.val()
                    for (team in teamsDict) {
                        teamsList.push(team)
                    }

                    //setup weeks beginning on Jun 01 2016
                    beginDate = moment().startOf('month')
                    finalDate = moment().startOf('month').add(1, 'Months')

                    startWeek = moment(beginDate).startOf('week')
                    endWeek = moment(finalDate).endOf('week')
                    durationDays = moment.duration(endWeek - startWeek).asDays()
                    durationWeeks = moment.duration(endWeek - startWeek).asWeeks()

                    // for (i = 0; i < durationWeeks; i++) {
                    //     startDay = moment(startWeek).add(1 * i, 'Weeks')
                    //     endDay = moment(startDay).add(6, 'Dasy')

                    //     var pitchCoworkingOffer = {
                    //         'isUpdate': true,
                    //         'goal' : 40,
                    //         'value': Math.round(Math.random() * 140),
                    //         'startWeekDay': startDay.valueOf(),
                    //     }
                    //     offerKey = firebase.database().ref('/KPIs/Coworking/Acquisition/TDOTC/weeks/').push(pitchCoworkingOffer).key;
                    // }

                    for (i = 0; i < durationDays; i++) {
                        day = moment(startWeek)
                        day = day.add(i, 'Days')
                        var pitchCoworkingOffer = {
                            'isUpdate': true,
                            'goal' : 40,
                            'value': 0,
                            'day': day.valueOf(),
                        }
                        offerKey = firebase.database().ref('/KPIs/Coworking/Acquisition/TDOTC/days/' + day).set(pitchCoworkingOffer).key;
                        var pitchCoworkingDemand = {
                            'numSeats': 0,
                            'responsible': {'id':'-KKhvWzhCdxPZNBWC3TS', 'name':'Kiev Gama', 'email':'kiev@cin.ufpe.br', 'phone':'(081) 98172-1670'},
                            'team': {
                                'id': '-KKidtqGo7rXYpcW3vwn',
                                'name': 'Arte de Rua',
                                'usesPortfolio': true,
                                'hasMsC': true,
                                'hasPhD': false
                            }
                        }

                        // key = firebase.database().ref('/Coworking/Acquisition/days/' + offerKey + '/availability/').set({'sun':96, 'mon':96, 'tue':96, 'wed':96, 'thu':96, 'fri':96, 'sat':96});

                        // key = firebase.database().ref('/Coworking/Acquisition/days/' + offerKey + '/teamDemands/').push(pitchCoworkingDemand);
                    }

                    //setup weeks beginning on Jun 01 2016
                    // beginDate = moment().startOf('month')
                    // finalDate = moment().startOf('month').add(1, 'Months')

                    // startWeek = moment(beginDate).startOf('week')
                    // endWeek = moment(finalDate).endOf('week')
                    // durationDays = moment.duration(endWeek - startWeek).asDays()
                    // durationWeeks = moment.duration(endWeek - startWeek).asWeeks()
                    
                    // team = teamsDict[teamsList[0]]
                    // for (i = 0; i < 7; i++) {
                    //     day = moment(startWeek).add(i, 'Days')
                    //     firebase.database().ref('/Coworking/Acquisition/Days/' + day.valueOf()).set(
                    //         {
                    //             'availability':96,
                    //             'day': day.valueOf()
                    //         }
                    //     )

                    //     firebase.database().ref('/Coworking/Acquisition/Days/' + day.valueOf() + '/teamDemands/' + teamsList[0]).set({'numSeats': 4,
                    //             'schedules': [moment(day).hour(8).valueOf()]
                    //             })
                    // }                    

                })
            })

            //

            // offerKey = '-KKx970y7c7KPv4aNtz3'


            // i = 0
            // for (day in {sun:'sun', mon:'mon', tue:'tue', wed:'wed', thu:'thu', fri:'fri', sat:'sat'}) {
            //     startInterval = new Date(startDate)
            //     endInterval = new Date(endDate)
            //     startInterval.setDate(startInterval.getDate() + i)
            //     endInterval.setDate(endInterval.getDate() + i)
            //     i++;
            //     interval = {'start':startInterval.valueOf(), 'end':endInterval.valueOf()};
            //     refString = '/Coworking/Acquisition/weeks/' + offerKey + '/teamDemands/' + key.key + '/schedules/' + day + '/';
            //     firebase.database().ref(refString).set(interval);
            // }
        }
    </script>
    <script type="text/javascript">
        $('#edit-KPI-modal').on('show.bs.modal', function() {
            $modal = $(this)
            $modal.find('.KPI-name').text(selectedMetric['name'])
            $modal.find('.KPI-description').text(selectedMetric['description'])
            $modal.find('#input-new-daily-goal').text(selectedMetric['dailyGoal'])
            $modal.find('#input-new-weekly-goal').text(selectedMetric['weeklyGoal'])
            $modal.find('#input-new-monthly-goal').text(selectedMetric['monthlyGoal'])
            if (selectedMetric['isPercent']) {
                $modal.find('.i-checks').iCheck('check')
            }else {
                $modal.find('.i-checks').iCheck('unchek')
            }
        })
    </script>
</body>
</html>
