<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>INSPINIA | Reflection Box</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <style type="text/css">
        #page-wrapper {
            margin: 0;
        }

        .wrapper-content {
            padding: 5px;
        }

        .widget {
            margin: 0;
        }

        .mailbox-header {
            padding-top: 10px;
        }

        .widget.navy-bg {
            border: solid 1px;
            color: #1ab394;
            background: #fff;
        }

        .mailbox-content {
            padding: 0;
        }

        .reflections-items-body {
            padding: 0;
        }

        .social-avatar {
            padding: 0;
            padding-bottom: 0;
        }


        .navbar-top-links li a {
            min-height: 30px;
        }

        .nav {
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .nav > li > a {
            padding: 10px 0;
            color: #676a6c;            
        }

        .nav > li.active {
            border-left: none;
        }

        .nav > li.active > a {
            color: #676a6c;            
        }

        .nav-second-level li a {
            padding: 7px 10px 7px 10px;
        }

        .nav > li.active {
            background: #e7eaec;
            color: #19aa8d;
        }


        .personality16-img {
            width: 50px;
            height: 50px;
        }

        .personality16-description {
            font-size: smaller;
        }

        .role {
            text-align: center;
        }

        .role.analysts {
            background: #cfb6ed;
        }

        .role.diplomats {
            background: #b5edbf;
        }

        .role.sentinels {
            background: #8bede4;
        }

        .role.explorers {
            background: #e8ed85;
        }

        .personality16-row > td {
            position: relative;
            text-align: center;
        }

        .num-personalities {
            position: absolute;
            font-size: 18px;
            font-weight: 700;
            color: red;
            top: 0px;
            left: 0px;
        }

        .num-total-classes {
            width: 50px;
            height: 50px;
            border-radius: 25px;
            color: white;
            background: #1ab394;
            float: right;
            position: absolute;
            padding: 8px 18px;
            top: 10px;
            right: 10px;
            font-size: x-large;
        }

        .student-email {
            position: absolute;
            top: 22px;
            left: 8px;
        }

        .fa.selected {
            color: #1ab394;
        }

    </style>
</head>

<body>

    <div id="wrapper">
        <div id="page-wrapper" class="gray-bg">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <span class="m-r-sm text-muted welcome-message"><span class="class-name"></span></span>
                        </li>
                        <li>
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#" aria-expanded="false">
                             <span class="text-muted text-xs block"><span class="user-name"></span> <b class="caret"></b></span> </span> 
                            </a>
                            <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                <!-- <li><a href="profile.html">Profile</a></li> -->
                                <!-- <li><a href="contacts.html">Contacts</a></li> -->
                                <!-- <li><a href="mailbox.html">Mailbox</a></li> -->
                                <li><a id="menu-reflections" href="cbl_reflections_box.html">Reflections</a></li>
                                <!-- <li class="divider"></li> -->
                                <li><a id="menu-logout" href="cbl_login_two_columns.html">Logout</a></li>
                            </ul>                            
                        </li>
                    </ul>
                </nav>
            </div>

            <div class="wrapper wrapper-content">
                <div class="row">
                    <div class="col-lg-2">
                        <div class="ibox float-e-margins">
                            <div class="ibox-content mailbox-content">
                                <div class="file-manager">
                                    <a id="btn-setup" type="button" class="btn btn-danger" href="#">setup</a>
                                    <h5>Roles</h5>
                                    <ul class="folder-list m-b-md" style="padding: 0">
                                        <li><a href="#" class="menu-show-personality16"> <i class="fa fa-certificate"></i> <span>All</span><span class="label label-danger pull-right"><span class="num-roles">0</span></a></li>
                                        <li><a href="#" class="menu-show-personality16"> <i class="fa fa-certificate"></i> <span>Analysts</span><span class="label label-danger pull-right"><span class="num-analysts">0</span></a></li>
                                        <li><a href="#" class="menu-show-personality16"> <i class="fa fa-certificate"></i> <span>Diplomats</span><span class="label label-danger pull-right"><span class="num-diplomats">0</span></a></li>
                                        <li><a href="#" class="menu-show-personality16"> <i class="fa fa-certificate"></i> <span>Sentinels</span><span class="label label-danger pull-right"><span class="num-sentinels">0</span></a></li>
                                        <li><a href="#" class="menu-show-personality16"> <i class="fa fa-certificate"></i> <span>Explorers</span><span class="label label-danger pull-right"><span class="num-explorers">0</span></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-10 reflections-panel">
                        <div class="classes-list students-info-list animated fadeInRight">
                            <div class="mail-box-header">
                                <h2>
                                    Classes List
                                </h2>
                                <span class="num-total-classes">0</span>
                            </div>
                            <div class="mail-box client-list">
                                <table class="table">
                                    <tbody class="classes-list-table-body">
                                        <tr class="class-row">
                                            <td class="client-avatar"><span class="fa fa-graduation-cap fa-2x"></span></td>
                                            <td style="position: relative;"><a href="#" class="cbl-class-name client-link">Anthony Jackson</a>
                                            <small class="student-email"></small></td>
                                            <!-- <td><span class="affiliation-info">Bepid 2016</span></td> -->
                                            <!-- <td><img class="personality16-img" src="img/esfj.png" style="height: 30px;"></td> -->
                                            <!-- <td class="role">NONE</td> -->
                                            <!-- <td class="personality">NONE</td> -->
                                            <td class="num-students">0</td>
                                        </tr>
                                    </tbody>                        
                                </table>
                            </div>                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer">
                <div class="pull-right">10GB of <strong>250GB</strong> Free.</div>
                <div>
                    <strong>Copyright</strong> Example Company &copy; 2014-2015
                </div>
            </div>
        </div>
    </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- Peity -->
    <script src="js/plugins/peity/jquery.peity.min.js"></script>

    <!-- Peity -->
    <script src="js/demo/peity-demo.js"></script>

    <script type="text/javascript" src="js/underscore-1.8.3.js"></script>

    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
    <script type="text/javascript">
        Parse.initialize("YALt9tjcUpW61Hz5aIPYbehm9uCgh5NXXRVM18T6", "5wwhJ6hfqu8cG4s6jMKMQWrmImiQKDTE9trvgL6x");
    </script>
<<<<<<< HEAD
    
=======



    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyD0jgyMEgjNXHNN95sbf-i0Xxzo9QybHxI",
        authDomain: "midyear-castle-816.firebaseapp.com",
        databaseURL: "https://midyear-castle-816.firebaseio.com",
        storageBucket: "midyear-castle-816.appspot.com",
      };
      firebase.initializeApp(config);
    </script>
        

<<<<<<< HEAD
>>>>>>> b006d1a986b12e6b11fea8a2cfcdb2d5e9797aa8
=======
>>>>>>> b006d1a986b12e6b11fea8a2cfcdb2d5e9797aa8
    <script type="text/javascript">
        var myClasses = [];
        var myClassesDict = {};

        $classRowRef = $('.class-row').detach();

        $navCBLClassRef = $('.nav-cbl-class-name').detach();
        $navCBLSprintRef = $('.nav-cbl-sprint-name').detach();

        function setup() {
            // _.each(myClasses, function(c) {
            //     moveClassToFirebase(c);
            // })
            var parseUsers = [];

            var parseClasses = [];
            var parseClassesDict = {};
            var parseSprints = [];
            var parseSprintsDict = {};

            var query = new Parse.Query(Parse.User);
            query.find(function(users) {
                parseUsers = users;
                // _.each(users, function(user) {
                //     if (user.get('isStudent')) {
                //         personality16 = user.get('personality16');
                //         if (!personality16) {
                //             personality16 = 'none';
                //         }
                //         fStudent = {
                //             'name': user.get('name'),
                //             'email': user.get('email'),
                //             'major': user.get('affiliation'),
                //             'personality16': user.get('personality16'),
                //             'currentCBLClass': 'none',
                //             'currentCBLClassName': 'none'
                //         }

                //         var studentKey = firebase.database().ref().child('student').push().key;
                //         var updates = {}
                //         updates['/students/' + studentKey] =  fStudent;
                //         firebase.database().ref().update(updates);
                //     }
                // })
            }).then(function() {
                CBLClass = Parse.Object.extend('CBLClass');
                query = new Parse.Query(CBLClass);
                return query.find().then(function(classes) {
                    parseClasses = classes;
                })
            }).then(function() {
                CBLSprint = Parse.Object.extend('CBLSprint');
                query = new Parse.Query(CBLSprint);
                return query.find().then(function(sprints) {
                    parseSprints = sprints;
                })
            }).then(function() {
                _.each(parseClasses, function(pClass) {
                    parseClassesDict[pClass.id] = pClass;
                    fClass = {
                        'name': pClass.get('name'),
                        'registrationCode': pClass.get('registrationCode')
                    }

                    var newClass = firebase.database().ref('CBLClasses').push(fClass);
                })
                _.each(parseSprints, function(pClass) {
                    parseSprintsDict[pClass.id] = pClass;
                })
            })
        }

        function moveClassToFirebase(c) {
            if (c) {
                fClass = {
                    'name': c.get('name'),
                    'registrationCode': c.get('registrationCode'),
                    'students':[],
                    'teachers': []
                }

                cStudents = [];
                students = c.get('students');
                _.each(students, function(student) {
                    fStudent = firebaseStudents[student.get('email')]
                    fClass['students'].push(fStudent.val()['email']);
                })

                cTeachers = [];
                teachers = c.get('teachers');
                _.each(teachers, function(teacher) {
                    fTeacher = firebaseTeachers[teacher.get('email')]
                    fClass['teachers'].push(fTeacher.val()['email']);
                })

                fClassId = firebase.database().ref('cblClasses/').push(fClass);
            }
        }

        function loadMyClasses() {
            var me = Parse.User.current();

            var CBLClass = Parse.Object.extend('CBLClass');
            var classQuery = new Parse.Query(CBLClass);
            classQuery.equalTo('teachers', me);
            classQuery.include('students');
            classQuery.include('teachers');
            return classQuery.find().then(function(cblClasses) {
                myClasses = cblClasses;

                _.each(cblClasses, function(cblClass) {
                    myClassesDict[cblClass.id] = cblClass;
                })
            })
        }

        function displayClassesList(cblClasses) {
            $('.classes-list-table-body').empty();
            $('.num-total-classes').text(cblClasses.length);

            _.each(cblClasses, function(cblClass) {
                $classRow = $classRowRef.clone();

                // if (student.get('photo')) {
                //     $classRow.find('.client-avatar').find('img').attr('src', student.get('photo').url());
                // }
                $classRow.attr('cbl-class-id', cblClass.id);
                $classRow.find('.cbl-class-name').text(cblClass.get('name'));
                $classRow.find('.cbl-class-name').attr('cbl-class-id', cblClass.id);

                if (cblClass.id == Parse.User.current().get('currentCBLClass').id) {
                    $classRow.find('.fa').toggleClass('selected');
                }
                // $classRow.find('.affiliation-info').text(cblClass.get('affiliation'));
                // $classRow.find('.student-email').text(cblClass.get('email'));
                $classRow.find('.num-students').text(cblClass.get('students').length);
                $classRow.appendTo('.classes-list-table-body');                            

            })

            $('.cbl-class-name').click(function() {
                $className = $(this);
                var me = Parse.User.current();
                var cblClassId = $(this).attr('cbl-class-id');
                var classToGo = myClassesDict[cblClassId];
                var sprintToGo = classToGo.get('cblSprints')[classToGo.get('cblSprints').length - 1];

                me.set('currentCBLClass', classToGo);
                me.set('currentCBLSprint', sprintToGo);
                me.save().then(function() {
                    $('.class-name').text(classToGo.get('name'));
                    $className.parents('.classes-list-table-body').find('.client-avatar').find('.fa').removeClass('selected');
                    $className.parents('.class-row').find('.client-avatar').find('.fa').toggleClass('selected');                    
                })
            })

            $('.classes-list-table-body .personality16-img').css('height', '30px');
            $('.classes-list-table-body .personality16-img').css('width', '30px');

            $('.class-name').click(function() {
                var studentId = $(this).parents('.class-row').attr('cbl-class-id');
                displayStudentProfile(studentId);
            })                
        }


        function displayPersonalities16(students) {
            _.each(students, function(student) {
                var personality16 = student.get('personality16')
                if ((personality16 == 'intj-a') || (personality16 == 'intj-t')) {
                    personalitiesDict['intj'].push(student);
                }else if ((personality16 == 'intp-a') || (personality16 == 'intp-t')) {
                    personalitiesDict['intp'].push(student);
                }else if ((personality16 == 'entp-a') || (personality16 == 'entp-t')) {
                    personalitiesDict['entp'].push(student);
                }else if ((personality16 == 'entj-a') || (personality16 == 'entj-t')) {
                    personalitiesDict['entj'].push(student);
                }else if ((personality16 == 'infj-a') || (personality16 == 'infj-t')) {
                    personalitiesDict['infj'].push(student);
                }else if ((personality16 == 'infp-a') || (personality16 == 'infp-t')) {
                    personalitiesDict['infp'].push(student);
                }else if ((personality16 == 'enfj-a') || (personality16 == 'enfj-t')) {
                    personalitiesDict['enfj'].push(student);
                }else if ((personality16 == 'enfp-a') || (personality16 == 'enfp-t')) {
                    personalitiesDict['enfp'].push(student);
                }else if ((personality16 == 'istj-a') || (personality16 == 'istj-t')) {
                    personalitiesDict['istj'].push(student);
                }else if ((personality16 == 'isfj-a') || (personality16 == 'isfj-t')) {
                    personalitiesDict['isfj'].push(student);
                }else if ((personality16 == 'estj-a') || (personality16 == 'estj-t')) {
                    personalitiesDict['estj'].push(student);
                }else if ((personality16 == 'esfj-a') || (personality16 == 'esfj-t')) {
                    personalitiesDict['esfj'].push(student);
                }else if ((personality16 == 'istp-a') || (personality16 == 'istp-t')) {
                    personalitiesDict['istp'].push(student);
                }else if ((personality16 == 'isfp-a') || (personality16 == 'isfp-t')) {
                    personalitiesDict['isfp'].push(student);
                }else if ((personality16 == 'estp-a') || (personality16 == 'estp-t')) {
                    personalitiesDict['estp'].push(student);
                }else if ((personality16 == 'esfp-a') || (personality16 == 'esfp-t')) {
                    personalitiesDict['esfp'].push(student);
                }
            })

            $('#num-intj-personalities').text(personalitiesDict['intj'].length);
            $('#num-intp-personalities').text(personalitiesDict['intp'].length);
            $('#num-entj-personalities').text(personalitiesDict['entj'].length);
            $('#num-entp-personalities').text(personalitiesDict['entp'].length);

            $('#num-infj-personalities').text(personalitiesDict['infj'].length);
            $('#num-infp-personalities').text(personalitiesDict['infp'].length);
            $('#num-enfj-personalities').text(personalitiesDict['enfj'].length);
            $('#num-enfp-personalities').text(personalitiesDict['enfp'].length);

            $('#num-istj-personalities').text(personalitiesDict['istj'].length);
            $('#num-isfj-personalities').text(personalitiesDict['isfj'].length);
            $('#num-estj-personalities').text(personalitiesDict['estj'].length);
            $('#num-esfj-personalities').text(personalitiesDict['esfj'].length);

            $('#num-istp-personalities').text(personalitiesDict['istp'].length);
            $('#num-isfp-personalities').text(personalitiesDict['isfp'].length);
            $('#num-estp-personalities').text(personalitiesDict['estp'].length);
            $('#num-esfp-personalities').text(personalitiesDict['esfp'].length);

            var numAnalysts = personalitiesDict['intj'].length + personalitiesDict['intp'].length + personalitiesDict['entp'].length + personalitiesDict['entj'].length;

            var numDiplomats = personalitiesDict['infj'].length + personalitiesDict['infp'].length + personalitiesDict['enfj'].length + personalitiesDict['enfp'].length;

            var numSentinels = personalitiesDict['istj'].length + personalitiesDict['isfj'].length + personalitiesDict['estj'].length + personalitiesDict['esfj'].length;

            var numExplorers = personalitiesDict['istp'].length + personalitiesDict['isfp'].length + personalitiesDict['estp'].length + personalitiesDict['esfp'].length;

            $('.num-roles').text(numAnalysts + numDiplomats + numSentinels + numExplorers);
            $('.num-analysts').text(numAnalysts);
            $('.num-diplomats').text(numDiplomats);
            $('.num-sentinels').text(numSentinels);
            $('.num-explorers').text(numExplorers);
        }
    </script>

    <script type="text/javascript">
        var students = [];
        var currentCBLClass;
        var currentUser;

        var personalitiesDict = {
            'intj':[], 'intp':[], 'entp':[], 'entj':[]
            ,'infj':[], 'infp':[], 'enfj':[], 'enfp':[]
            ,'istj':[], 'isfj':[], 'estj':[], 'esfj':[]
            ,'istp':[], 'isfp':[], 'estp':[], 'esfp':[]
        }

        $(function() {
            $btnSetup = $('#btn-setup').detach();

            var user = Parse.User.current();
            if (user && user.get('email') == 'cca2@cin.ufpe.br') {
                $btnSetup.prependTo('.file-manager');
                $('#btn-setup').click(function() {
                    setup();
                })
            }

            if (user) {
                currentUser = user;

                if (!currentUser.get('currentCBLClass')) {
                    currentUser.logOut();
                    window.location = 'cbl_login_two_columns.html';
                }else {

                }

                loadMyClasses().then(function() {
                    // displayClassesList(myClasses);
                })

                var CBLClass = Parse.Object.extend('CBLClass');
                var cblClassQuery = new Parse.Query(CBLClass);
                cblClassQuery.include('students');
                cblClassQuery.include('cblSprints');
                cblClassQuery.get(currentUser.get('currentCBLClass').id).then(function(cblClass) {
                    currentCBLClass = cblClass;
                    students = currentCBLClass.get('students').sort(function(a, b){

                        if (!a) {
                            return 1;
                        }

                        a = a.get('name');
                        b = b.get('name');
                        if (a > b) {
                            return 1;
                        }else if (a < b) {
                            return -1;
                        }else {
                            return 0;
                        }
                    });

                    $('.class-name').text(cblClass.get('name'));
                })

                $('.user-name').text(user.get('name'));
                // var query = new Parse.Query(Parse.User);
                // query.ascending('firstName');
                // query.limit(100);
                // query.include('currentCBLClass');
                // query.include('currentCBLSprint');
                // query.find().then(function(users) {
                    // _.each(users, function(user) {
                    //     if (user.get('isStudent')) {
                    //         cblClasses.push(user);
                    //     }else {
                    //         teachers.push(user);
                    //     }
                    // })
            }else {
                window.location = "cbl_login_two_columns.html";
            }
        })


        $('#link-logout').click(function() {
            Parse.User.logOut();
        })

        $('#menu-logout').click(function() {
            Parse.User.logOut();
        })
        
    </script>

    <!-- iCheck -->
    <script src="js/plugins/iCheck/icheck.min.js"></script>
    <script>
        $(document).ready(function(){
            $('.i-checks').iCheck({
                checkboxClass: 'icheckbox_square-green',
                radioClass: 'iradio_square-green',
            });
        });
    </script>
</body>

</html>
