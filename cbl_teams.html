<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>INNOVATORSMAKER | Teams</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <style type="text/css">
        #page-wrapper {
            margin: 0;
        }

        .wrapper-content {
            padding: 5px;
        }

        .widget {
            margin: 0;
        }

        .mailbox-header {
            padding-top: 10px;
        }

        .widget.navy-bg {
            border: solid 1px;
            color: #1ab394;
            background: #fff;
        }

        .mailbox-content {
            padding: 0;
        }

        .reflections-items-body {
            padding: 0;
        }

        .social-avatar {
            padding: 0;
            padding-bottom: 0;
        }

        .student-reflection-item p {
            margin-top: 10px;
            margin-bottom: 0;
        }

        .btn-student-profile-show {
            width: 68px;
        }

        .navbar-top-links li a {
            min-height: 30px;
        }

        .nav {
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .nav > li > a {
            padding: 10px 0;
            color: #676a6c;            
        }

        .nav > li.active {
            border-left: none;
        }

        .nav > li.active > a {
            color: #676a6c;            
        }

        .nav-second-level li a {
            padding: 7px 10px 7px 10px;
        }

        .nav > li.active {
            background: #e7eaec;
            color: #19aa8d;
        }

        .btn-show-reflections {
            width: 60px;
        }

        #btn-new-reflection-statement {
            width: 100%;
        }

        .separator-reflection-timeline-item > .row > .content {
            min-height: 30px;
        }

        .timeline-item .date {
            width: 70px;
        }

        .reflection-media-type-form {
            padding: 10px;
            height: 40px;
        }

        .reflection-media-type-form label {
            margin: 0;
        }

        .new-reflection-modal-body {
            padding: 0;
        }

        .new-team-textarea {
            width: 100%;
            padding: 10px;
            border: none;
        }

        .modal-form-control {
            margin: 10px 0;
        }

        .student-with-no-team-row > td {
            position: relative;
        }

        .student-email {
            position: absolute;
            top: 22px;
            left: 8px;
        }

        .num-student-pending-reflections {
            font-size: 20px;
            font-weight: 700;
        }

        .team-member {
            position: relative;
            padding: 5px;
            border: solid 1px;
            border-radius: 5px;
            text-align: center;
        }

        .team-member img {
            padding: 5px;
        }

        .team-member > a > img.img-circle {
            height: 100px;
            width: 100px;
        }

        img.member-personality16-img {
            height:60px;
            position: absolute;
            left: 0px;
            top: 130px
        }

        img.new-team-member-personality16-img {
            height: 60px;
        }

        #new-challenge-modal .modal-dialog {
            width: 800px;
        }

        #new-challenge-modal .modal-header {
            padding: 15px 15px;
        }

        .new-team-member-remove:hover {
            cursor: pointer;
        }

        .new-team-member-row img.member-photo.img-circle {
            height: 60px;
        }

        .team-ibox {
            margin: 0;
        }

        .twitter-typeahead {
            width: 100%;
        }

typeahead,
.tt-query,
.tt-hint {
  height: 30px;
  padding: 8px 12px;
  font-size: 14px;
  line-height: 30px;
  border: 2px solid #ccc;
  -webkit-border-radius: 8px;
     -moz-border-radius: 8px;
          border-radius: 8px;
  outline: none;
}

.typeahead {
  background-color: #fff;
}

.typeahead:focus {
  border: 2px solid #0097cf;
}

.tt-query {
  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
     -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
          box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
}

.tt-hint {
  color: #999
}

.tt-menu {
  width: 422px;
  margin: 12px 0;
  padding: 8px 0;
  background-color: #fff;
  border: 1px solid #ccc;
  border: 1px solid rgba(0, 0, 0, 0.2);
  -webkit-border-radius: 8px;
     -moz-border-radius: 8px;
          border-radius: 8px;
  -webkit-box-shadow: 0 5px 10px rgba(0,0,0,.2);
     -moz-box-shadow: 0 5px 10px rgba(0,0,0,.2);
          box-shadow: 0 5px 10px rgba(0,0,0,.2);
}

.tt-suggestion {
  padding: 3px 20px;
  font-size: 18px;
  line-height: 24px;
}

.tt-suggestion:hover {
  cursor: pointer;
  color: #fff;
  background-color: #0097cf;
}

.tt-suggestion.tt-cursor {
  color: #fff;
  background-color: #0097cf;

}

.tt-suggestion p {
  margin: 0;
}
    </style>
</head>

<body>

    <div id="wrapper">
        <div id="page-wrapper" class="gray-bg">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <span class="m-r-sm text-muted welcome-message"><span class="cbl-class-name"></span></span>
                        </li>
                        <li>
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#" aria-expanded="false">
                             <span class="text-muted text-xs block"><span class="user-name"></span> <b class="caret"></b></span> </span> 
                            </a>
                            <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                <!-- <li><a href="profile.html">Profile</a></li> -->
                                <!-- <li><a href="contacts.html">Contacts</a></li> -->
                                <!-- <li><a href="mailbox.html">Mailbox</a></li> -->
                                <li><a id="menu-reflections" href="cbl_reflections_box.html">Reflections</a></li>
                                <li><a id="menu-teams" href="cbl_teams.html">Teams</a></li>
                                <!-- <li class="divider"></li> -->
                                <li><a id="menu-logout" href="cbl_login_two_columns.html">Logout</a></li>
                            </ul>                            
                        </li>
                    </ul>
                </nav>
            </div>

            <div class="wrapper wrapper-content">
                <div class="row">
                    <div class="col-lg-2">
                        <div class="ibox float-e-margins">
                            <div class="ibox-content mailbox-content">
                                <div class="file-manager">
                                    <!-- <a id="btn-setup" type="button" class="btn btn-danger" href="#">setup</a> -->
                                    <div class="widget style1 navy-bg">
                                        <div class="row">
                                            <div class="col-xs-12 text-center">
                                                <h3 class="cbl-sprint-name font-bold">Sprint#0</h3>
                                            </div>
                                        </div>
                                    </div>                                    
                                    <div class="space-25"></div>
                                    <h5>Teams</h5>
                                    <ul class="folder-list m-b-md" style="padding: 0">
                                        <li><a href="#" class="menu-show-students-reflections"> <i class="fa fa-users "></i>  All<span class="label label-primary pull-right"><span class="total-teams">0</span></span> </a></li>
                                        <!-- <li><a href="#" class="menu-show-teachers-reflections"> <i class="fa fa-envelope-o"></i> Active<span class="label label-primary pull-right"><span class="total-active-teams">0</span></a></li> -->
                                    </ul>

                                    <a id="btn-new-team" type="button" class="btn btn-primary" style="width: 100%;" href="#">Propose new challenge</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-10 challenges-panel">
                        <div class="challenges-list animated fadeInRight">
                            <!-- <div class="teams-box col-lg-12">  -->
                                <div class="challenge-ibox ibox" style="margin:0;">
                                    <div class="ibox-title" style="background: #1ab394; color: #fff;">
                                        <h5 class="challenge-name">IT-01 - Design Team</h5>
                                    </div>
                                    <div class="ibox-content">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="widget-text-box" style="padding:10px;">
                                                    <h4 class="media-heading">Solution Constraints</h4>
                                                    <ul>
                                                        <li>Positive impact on people's lifes</li>
                                                        <li>Fully functional</li>
                                                        <li>Delightfull visual</li>
                                                    </ul>
                                                </div>
                                            </div>                                    
                                            <div class="col-md-4">
                                                <div class="widget-text-box" style="padding:10px;">
                                                    <h4 class="media-heading">Technology Constraints</h4>
                                                    <ul>
                                                        <li>IOS App</li>
                                                        <li>Swift</li>
                                                        <li>Single View App</li>
                                                    </ul>
                                                </div>
                                            </div>                                    
                                            <div class="col-md-4">
                                                <div class="widget-text-box" style="padding:10px;">
                                                    <h4 class="media-heading">Team Constraints</h4>
                                                    <ul>
                                                        <li>4 or 5 people</li>
                                                        <li>Don't mix computer and non computer people</li>
                                                    </ul>
                                                </div>
                                            </div>                                            
                                        </div>  
                                        <div class="row" style="margin-top: 10px;">
                                            <div class="cbl-phases-panel col-md-12">
                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="big-idea-icon" src="img/Icones-CBL/Big-Idea-null.png" style="height: 30px;">
                                                    </div>
                                                    <div class="col-md-2">
                                                        <span>Big Idea</span>
                                                    </div>
                                                    <div class="col-md-7">
                                                        <span>What is the interest domain of the team? A high level of abstraction concept (i.e. Health, insurence, entertainment, etc.)</span>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button type="button" class="btn-start-big-idea btn btn-outline btn-primary">Start</button>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="" src="img/Icones-CBL/Essencial-Question-null.png" style="height: 30px;">
                                                    </div>
                                                    <div class="col-md-2">
                                                        <span>Essential Question</span>
                                                    </div>
                                                    <div class="col-md-7">
                                                        <span>What is the interest domain of the team? A high level of abstraction concept (i.e. Health, insurence, entertainment, etc.)</span>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button type="button" class="btn btn-outline btn-primary">Start</button>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="" src="img/Icones-CBL/Challenge-null.png" style="height: 30px;">
                                                    </div>
                                                    <div class="col-md-2">
                                                        <span>Challenge</span>
                                                    </div>
                                                    <div class="col-md-7">
                                                        <span>What is the interest domain of the team? A high level of abstraction concept (i.e. Health, insurence, entertainment, etc.)</span>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button type="button" class="btn btn-outline btn-primary">Start</button>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="" src="img/Icones-CBL/Solution-null.png" style="height: 30px;">
                                                    </div>
                                                    <div class="col-md-2">
                                                        <span>Solution</span>
                                                    </div>
                                                    <div class="col-md-7">
                                                        <span>What is the interest domain of the team? A high level of abstraction concept (i.e. Health, insurence, entertainment, etc.)</span>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button type="button" class="btn btn-outline btn-primary">Start</button>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="" src="img/Icones-CBL/Implementation-null.png" style="height: 30px;">
                                                    </div>
                                                    <div class="col-md-2">
                                                        <span>Implementation</span>
                                                    </div>
                                                    <div class="col-md-7">
                                                        <span>What is the interest domain of the team? A high level of abstraction concept (i.e. Health, insurence, entertainment, etc.)</span>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button type="button" class="btn btn-outline btn-primary">Start</button>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-1">
                                                        <img class="" src="img/Icones-CBL/Evaluation-null.png" style="height: 30px;">
                                                    </div>
                                                    <div class="col-md-2">
                                                        <span>Evaluation</span>
                                                    </div>
                                                    <div class="col-md-7">
                                                        <span>What is the interest domain of the team? A high level of abstraction concept (i.e. Health, insurence, entertainment, etc.)</span>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <button type="button" class="btn btn-outline btn-primary">Start</button>
                                                    </div>
                                                </div>                                                
                                            </div>
                                        </div>
                                        <div class="row" style="margin-top:5px">
                                            <div class="col-md-12">
                                                <div class="mail-box client-list">
                                                    <table class="table" style="margin:0;">
                                                        <tbody class="students-pending-reflections-table-body row">
                                                            <tr class="student-with-no-team-row">
                                                                <td class="client-avatar"><img alt="image" src="img/a2.jpg"></td>
                                                                <td><a data-toggle="tab" href="#contact-1" class="student-name client-link">Anthony Jackson</a>
                                                                <small class="student-email"></small></td>
                                                                <td><span class="student-affiliation-info">Bepid 2016</span></td>
                                                                <td><img class="student-personality16-img" src="img/esfj.png" style="height: 30px;"></td>
                                                                <td class="role">NONE</td>
                                                                <td class="personality">NONE</td>
                                                                <td class="strategy">NONE</td>
                                                            </tr>
                                                        </tbody>                        
                                                    </table>
                                                </div>                                               
                                            </div>
                                        </div>                              
                                    </div>                                    
                                </div>                               
                                <div class="team-ibox ibox">
                                    <div class="ibox-title">
                                        <span class="is-active-label label label-primary pull-right">ACTIVE</span>
                                        <h5><a class="team-name" href="cbl_team_profile.html">IT-01 - Design Team</a></h5>
                                    </div>
                                    <div class="ibox-content">
<!--                                         <div class="row">
                                            <div class="col-md-4">
                                                <div class="widget-text-box" style="padding:10px;">
                                                    <h4 class="media-heading">Big Idea</h4>
                                                    <p class="big-idea-p">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="widget-text-box" style="padding:10px;">
                                                    <h4 class="media-heading">Essential Question</h4>
                                                    <p class="essential-question-p">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="widget-text-box" style="padding:10px;">
                                                    <h4 class="media-heading">Challenge</h4>
                                                    <p class="challenge-p">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</p>
                                                </div>
                                            </div>
                                        </div> -->
                                        <div class="row">
                                            <div class="col-md-8">
                                                <div class="team-members" style="margin:10px 0 0 -5px;">
                                                    <div class="team-member-col col-md-3" style="padding: 0 0 5px 5px;">
                                                        <div class="team-member">
                                                            <h4 class="member-name" style="margin: 5px 0 0 0;">Daniel de Jesus Oliveira</h4>
                                                            <div class="row">
                                                                <small class="member-affiliation">Design</small>
                                                            </div>
                                                            <a href="#"><img alt="member" class="member-photo img-circle" src="img/a1.jpg"><img class="member-personality16-img" src="img/intp.png"></a>
                                                            <p class="role" style="margin:0;">Explorer</p>
                                                            <p class="personality" style="margin:0;">Architect</p>
                                                            <p class="strategy" style="margin:0;">Constant Improvement</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4" style="margin-top: 10px;">
<!--                                                 <div class="widget style1 navy-bg">
                                                    <div class="row">
                                                        <div class="col-xs-4">
                                                            <a class="fa fa-play fa-3x" href="https://www.dropbox.com/s/8u13joloupie4od/PooLess.m4v?dl=0" target="_blank"></a>
                                                        </div>
                                                        <div class="col-xs-8 text-right">
                                                            <span> Stage </span>
                                                            <h3 class="font-bold">idea</h3>
                                                        </div>
                                                    </div>
                                                </div> -->
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <div class="" style="padding: 20px;">
                                                        <a href="https://www.dropbox.com/s/8u13joloupie4od/PooLess.m4v?dl=0" target="_blank" class="fa fa-file-pdf-o fa-3x"></a>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="" style="padding: 20px;">
                                                        <a href="https://www.dropbox.com/s/8u13joloupie4od/PooLess.m4v?dl=0" target="_blank" class="fa fa-file-image-o fa-3x"></a>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="" style="padding: 20px;">
                                                        <a href="https://www.dropbox.com/s/8u13joloupie4od/PooLess.m4v?dl=0" target="_blank" class="fa fa-file-video-o fa-3x"></a>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="" style="padding: 20px;">
                                                        <a href="https://www.dropbox.com/s/8u13joloupie4od/PooLess.m4v?dl=0" target="_blank" class="fa fa-file-code-o fa-3x"></a>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="" style="padding: 20px;">
                                                        <a href="https://www.dropbox.com/s/8u13joloupie4od/PooLess.m4v?dl=0" target="_blank" class="fa fa-file-sound-o fa-3x"></a>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="" style="padding: 20px;">
                                                        <a href="https://www.dropbox.com/s/8u13joloupie4od/PooLess.m4v?dl=0" target="_blank" class="fa fa-file-powerpoint-o fa-3x"></a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <!-- </div> -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer">
                <div class="pull-right">10GB of <strong>250GB</strong> Free.</div>
                <div>
                    <strong>Copyright</strong> Example Company &copy; 2014-2015
                </div>
            </div>
        </div>

        <div class="modal inmodal" id="new-challenge-modal" tabindex="-1" role="dialog" aria-hidden="true" student-reflection-statement-id="" teacher-reflection-statement-id="P34QuDoziO">
            <div class="modal-dialog">
                <div class="modal-content animated">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Give a name to a new CBL Cycle</h4>
                    </div>
                    <div class="modal-body">
                        <input id='input-challenge-name' class="form-control" placeholder="mini challenge#0"></input>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                        <button id="btn-submit-new-cbl-cycle" type="button" class="btn btn-primary">submit new CBL cycle</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal inmodal" id="new-big-idea-modal" tabindex="-1" role="dialog" aria-hidden="true" student-reflection-statement-id="" teacher-reflection-statement-id="P34QuDoziO">
            <div class="modal-dialog">
                <div class="modal-content animated">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Describe the Big Idea concept to the class</h4>
                    </div>
                    <div class="modal-body">
                        <div class="progress progress-small">
                            <div style="width: 0%;" class="progress-bar"></div>
                        </div>
                        <small class="new-challenge-progress-message"></small>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- Peity -->
    <script src="js/plugins/peity/jquery.peity.min.js"></script>

    <!-- Peity -->
    <script src="js/demo/peity-demo.js"></script>

    <script type="text/javascript" src="js/underscore-1.8.3.js"></script>

    <!-- Typeahead-->
    <script type="text/javascript" src="js/typeahead.bundle.js"></script>

   <!-- Switchery -->
   <script src="js/plugins/switchery/switchery.js"></script>

    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
    <script type="text/javascript">
        Parse.initialize("YALt9tjcUpW61Hz5aIPYbehm9uCgh5NXXRVM18T6", "5wwhJ6hfqu8cG4s6jMKMQWrmImiQKDTE9trvgL6x");
    </script>

    <script type="text/javascript">
        var $teamMemberRef = $('.team-member-col').detach();
        var $teamIboxRef = $('.team-ibox').detach();
        var $challengeIboxRef = $('.challenge-ibox').detach();
        var $newTeamMemberRowRef = $('.new-team-member-row').detach();

        var teams = [];
        var students = [];
        var studentsDict = {};
        var studentsByNameDict = {};
        var teachers = [];
        var currentCBLClass;
        var currentCBLSprint;
        var currentUser;

        function setup() {
            var challengeDict = {};
            var teamDict = {};

            var ActivityStatement = Parse.Object.extend('ActivityStatement');
            asQuery = new Parse.Query(ActivityStatement);
            asQuery.include('activities.newTeam')
            asQuery.find().then(function(statements) {
                var promise = Parse.Promise.as();
                _.each(statements, function(statement) {
                    var activities = statement.get('activities');
                    var challenge = statement.get('cblChallenge');
                    _.each(activities, function(activity) {
                        var newTeam = activity.get('newTeam');
                        activity.set('cblChallenge', statement.get('cblChallenge'));
                        promise = promise.then(function() {
                          return activity.save();  
                        })

                        if (newTeam) {
                            newTeam.set('cblCycle', challenge);
                            newTeam.save();
                            challenge.addUnique('teams', newTeam);
                        }
                    })
                })
            })

            // var Challenge = Parse.Object.extend('Challenge')
            // challengeQuery = new Parse.Query(Challenge)
            // challengeQuery.find().then(function(challenges) {
            //     _.each(challenges, function(challenge) {
            //         challengeDict[challenge.id] = challenge;
            //     })

            //     var Team = Parse.Object.extend('Team')
            //     teamQuery = new Parse.Query(Team)
            //     teamQuery.find().then(function(teams) {
            //         _.each(teams, function(team) {
            //             var teamChallengeId = team.get('cblCycle').id;
            //             challengeDict[teamChallengeId].addUnique('teams', team);
            //         })
    
            //         _.each(challenges, function(challenge) {
            //             challengeDict[challenge.id].save();
            //         })                
            //     })
            // })
        }

        function loadStudentsWithNoTeam(challenge) {
            var studentsWithNoTeams = [];
            var Activity = Parse.Object.extend('Activity');
            var query = new Parse.Query(Activity);
            query.include('author');
            query.include('statement');
            query.equalTo('cblChallenge', challenge);
            query.doesNotExist('newTeam');
            return query.find().then(function(activities) {
                _.each(activities, function(activity) {
                    var isNewTeam = activity.get('statement').get('isNewTeam');
                    if (isNewTeam) {
                        studentsWithNoTeams.push(activity.get('author'));
                    }
                })

                return studentsWithNoTeams;
            })
        }

        function getPersonalityImg(personality16) {
            var personalityPrefix = personality16.substring(0,4);
            return 'img/' + personalityPrefix + '.png';
        }

        function getPersolity16Info(personality16) {
            var res = {};
            switch(personality16) {
                case('none') : {
                    break;
                }
                case('intj-a') : {
                    res['role'] = 'Analyst';
                    res['strategy'] = 'Confident Individualism';
                    res['personality'] = 'Architect';
                    break;
                }
                case('intp-a') : {
                    res['role'] = 'Analyst';
                    res['strategy'] = 'Confident Individualism';
                    res['personality'] = 'Logician';
                    break;
                }
                case('entj-a') : {
                    res['role'] = 'Analyst';
                    res['strategy'] = 'People Mastery';
                    res['personality'] = 'Commander';
                    break;
                }
                case('entp-a') : {
                    res['role'] = 'Analyst';
                    res['strategy'] = 'People Mastery';
                    res['personality'] = 'Debater';
                    break;
                }
                case('intj-t') : {
                    res['role'] = 'Analyst';
                    res['strategy'] = 'Constant Improvement';
                    res['personality'] = 'Architect';
                    break;
                }
                case('intp-t') : {
                    res['role'] = 'Analyst';
                    res['strategy'] = 'Constant Improvement';
                    res['personality'] = 'Logician';
                    break;
                }
                case('entj-t') : {
                    res['role'] = 'Analyst';
                    res['strategy'] = 'Social Engagement';
                    res['personality'] = 'Commander';
                    break;
                }
                case('entp-t') : {
                    res['role'] = 'Analyst';
                    res['strategy'] = 'Social Engagement';
                    res['personality'] = 'Debater';
                    break;
                }

                case('infj-a') : {
                    res['role'] = 'Diplomat';
                    res['strategy'] = 'Confident Individualism';
                    res['personality'] = 'Advocate';
                    break;
                }
                case('infp-a') : {
                    res['role'] = 'Diplomat';
                    res['strategy'] = 'Confident Individualism';
                    res['personality'] = 'Mediator';
                    break;
                }
                case('enfj-a') : {
                    res['role'] = 'Diplomat';
                    res['strategy'] = 'People Mastery';
                    res['personality'] = 'Protagonist';
                    break;
                }
                case('enfp-a') : {
                    res['role'] = 'Diplomat';
                    res['strategy'] = 'People Mastery';
                    res['personality'] = 'Campaigner';
                    break;
                }
                case('infj-t') : {
                    res['role'] = 'Diplomat';
                    res['strategy'] = 'Constant Improvement';
                    res['personality'] = 'Advocate';
                    break;
                }
                case('infp-t') : {
                    res['role'] = 'Diplomat';
                    res['strategy'] = 'Constant Improvement';
                    res['personality'] = 'Mediator';
                    break;
                }
                case('enfj-t') : {
                    res['role'] = 'Diplomat';
                    res['strategy'] = 'Social Engagement';
                    res['personality'] = 'Protagonist';
                    break;
                }
                case('enfp-t') : {
                    res['role'] = 'Diplomat';
                    res['strategy'] = 'Social Engagement';
                    res['personality'] = 'Campaigner';
                    break;
                }

                case('istj-a') : {
                    res['role'] = 'Sentinel';
                    res['strategy'] = 'Confident Individualism';
                    res['personality'] = 'Logistician';
                    break;
                }
                case('isfj-a') : {
                    res['role'] = 'Sentinel';
                    res['strategy'] = 'Confident Individualism';
                    res['personality'] = 'Defender';
                    break;
                }
                case('estj-a') : {
                    res['role'] = 'Sentinel';
                    res['strategy'] = 'People Mastery';
                    res['personality'] = 'Executive';
                    break;
                }
                case('esfj-a') : {
                    res['role'] = 'Sentinel';
                    res['strategy'] = 'People Mastery';
                    res['personality'] = 'Consul';
                    break;
                }
                case('istj-t') : {
                    res['role'] = 'Sentinel';
                    res['strategy'] = 'Constant Improvement';
                    res['personality'] = 'Logistician';
                    break;
                }
                case('isfj-t') : {
                    res['role'] = 'Sentinel';
                    res['strategy'] = 'Constant Improvement';
                    res['personality'] = 'Defender';
                    break;
                }
                case('estj-t') : {
                    res['role'] = 'Sentinel';
                    res['strategy'] = 'Social Engagement';
                    res['personality'] = 'Executive';
                    break;
                }
                case('esfj-t') : {
                    res['role'] = 'Sentinel';
                    res['strategy'] = 'Social Engagement';
                    res['personality'] = 'Consul';
                    break;
                }

                case('istp-a') : {
                    res['role'] = 'Explorer';
                    res['strategy'] = 'Confident Individualism';
                    res['personality'] = 'Virtuoso';
                    break;
                }
                case('isfp-a') : {
                    res['role'] = 'Explorer';
                    res['strategy'] = 'Confident Individualism';
                    res['personality'] = 'Adventurer';
                    break;
                }
                case('estp-a') : {
                    res['role'] = 'Explorer';
                    res['strategy'] = 'People Mastery';
                    res['personality'] = 'Entrepreneur';
                    break;
                }
                case('esfp-a') : {
                    res['role'] = 'Explorer';
                    res['strategy'] = 'People Mastery';
                    res['personality'] = 'Entertainer';
                    break;
                }
                case('istp-t') : {
                    res['role'] = 'Explorer';
                    res['strategy'] = 'Constant Improvement';
                    res['personality'] = 'Virtuoso';
                    break;
                }
                case('isfp-t') : {
                    res['role'] = 'Explorer';
                    res['strategy'] = 'Constant Improvement';
                    res['personality'] = 'Adventurer';
                    break;
                }
                case('estp-t') : {
                    res['role'] = 'Explorer';
                    res['strategy'] = 'Social Engagement';
                    res['personality'] = 'Entrepreneur';
                    break;
                }
                case('esfp-t') : {
                    res['role'] = 'Explorer';
                    res['strategy'] = 'Social Engagement';
                    res['personality'] = 'Entertainer';
                    break;
                }
            }

            return res;            
        }

        function loadChallenges() {
            var Challenge = Parse.Object.extend('Challenge')
            challengeQuery = new Parse.Query(Challenge)
            challengeQuery.equalTo('cblClass', Parse.User.current().get('currentCBLClass'));
            challengeQuery.include('teams.members');
            challengeQuery.include('cblSprint');
            challengeQuery.include('cblClass');
            return challengeQuery.find();
        }

        function displayChallenges(challenges) {
            var challenges = challenges.sort(function(a, b){

                        if (!a) {
                            return 1;
                        }

                        a = a.createdAt;
                        b = b.createdAt;
                        if (a > b) {
                            return -1;
                        }else if (a < b) {
                            return 1;
                        }else {
                            return 0;
                        }
                    });

            var promise = Parse.Promise.as();

            _.each(challenges, function(challenge) {
                var $challengeIbox = $challengeIboxRef.clone();
                $challengeIbox.attr('challenge-id', challenge.id);
                $challengeIbox.find('.challenge-name').text(challenge.get('cblSprint').get('name') + ' - ' + challenge.get('name'));


                $challengeStudentWithoutTeamRef = $challengeIbox.find('.student-with-no-team-row').detach();

                promise = promise.then(function() {
                    loadStudentsWithNoTeam(challenge).then(function(studentsWithNoTeam) {
                        _.each(studentsWithNoTeam, function(student) {                        
                            $studentRow = $challengeStudentWithoutTeamRef.clone();
                            $studentRow.find('.student-name').text(student.get('name'));
                            $studentRow.appendTo($challengeIbox.find($('.students-pending-reflections-table-body')));

                            $studentRow.find('.student-affiliation-info').text(student.get('affiliation'));

                            var personality16Info = getPersolity16Info(student.get('personality16'));
                            $studentRow.find('.role').text(personality16Info['role']);
                            $studentRow.find('.strategy').text(personality16Info['strategy']);
                            $studentRow.find('.personality').text(personality16Info['personality']);

                            var personality16Img = getPersonalityImg(student.get('personality16'));
                            $studentRow.find('.student-personality16-img').attr('src', personality16Img);

                            if (student.get('photo')) {
                                $studentRow.find('.client-avatar').find('img').attr('src', student.get('photo').url());
                            }
                        })
                    })
                })

                if (challenge.get('onBigIdea')) {
                    $challengeIbox.find('.btn-start-big-idea').prop('disabled', true);
                    $challengeIbox.find('.big-idea-icon').attr('src', 'img/Icones-CBL/Big-Idea.png');
                    $challengeIbox.find('.btn-start-big-idea').text('On Going');
                }

                $challengeIbox.appendTo('.challenges-list');
                var teams = challenge.get('teams');
                _.each(teams, function(team) {
                    var $teamIbox = $teamIboxRef.clone();
                    var members = team.get('members');

                    $teamIbox.appendTo($('.challenges-list'));                

                    $teamIbox.find('.team-name').text(team.get('name') + ' - ' + challenge.get('name'));
                    $teamIbox.find('.big-idea-p').text(team.get('bigIdea'));
                    $teamIbox.find('.essential-question-p').text(team.get('essentialQuestion'));
                    $teamIbox.find('.challenge-p').text(team.get('challenge'));

                    _.each(members, function(member) {
                        var personality16 = member.get('personality16');
                        var personalityPrefix = personality16.substring(0,4);

                        $teamMember = $teamMemberRef.clone();
                        if (member.get('photo')) {
                            $teamMember.find('img.img-circle').attr('src', member.get('photo').url());
                        }
                        $teamMember.find('img.member-personality16-img').attr('src', 'img/' + personalityPrefix + '.png');

                        var name = member.get('name');
                        var nameWords = name.split(' ');
                        var firstAndLastName = nameWords[0];
                        if (nameWords.length > 1) {
                            firstAndLastName += ' ' + nameWords[nameWords.length - 1];
                        }
                        $teamMember.find('.member-name').text(firstAndLastName);
                        $teamMember.find('.member-affiliation').text(member.get('affiliation'));

                        var role = 'Undefined';
                        var personlity = 'Undefined';
                        var strategy = 'Undefined';

                        switch(personality16) {
                            case('none') : {
                                break;
                            }
                            case('intj-a') : {
                                $teamMember.find('.role').text('Analyst');
                                $teamMember.find('.strategy').text('Confident Individualism');
                                $teamMember.find('.personality').text('Architect');
                                break;
                            }
                            case('intp-a') : {
                                $teamMember.find('.role').text('Analyst');
                                $teamMember.find('.strategy').text('Confident Individualism');
                                $teamMember.find('.personality').text('Logician');
                                break;
                            }
                            case('entj-a') : {
                                $teamMember.find('.role').text('Analyst');
                                $teamMember.find('.strategy').text('People Mastery');
                                $teamMember.find('.personality').text('Commander');
                                break;
                            }
                            case('entp-a') : {
                                $teamMember.find('.role').text('Analyst');
                                $teamMember.find('.strategy').text('People Mastery');
                                $teamMember.find('.personality').text('Debater');
                                break;
                            }
                            case('intj-t') : {
                                $teamMember.find('.role').text('Analyst');
                                $teamMember.find('.strategy').text('Constant Improvement');
                                $teamMember.find('.personality').text('Architect');
                                break;
                            }
                            case('intp-t') : {
                                $teamMember.find('.role').text('Analyst');
                                $teamMember.find('.strategy').text('Constant Improvement');
                                $teamMember.find('.personality').text('Logician');
                                break;
                            }
                            case('entj-t') : {
                                $teamMember.find('.role').text('Analyst');
                                $teamMember.find('.strategy').text('Social Engagement');
                                $teamMember.find('.personality').text('Commander');
                                break;
                            }
                            case('entp-t') : {
                                $teamMember.find('.role').text('Analyst');
                                $teamMember.find('.strategy').text('Social Engagement');
                                $teamMember.find('.personality').text('Debater');
                                break;
                            }

                            case('infj-a') : {
                                $teamMember.find('.role').text('Diplomat');
                                $teamMember.find('.strategy').text('Confident Individualism');
                                $teamMember.find('.personality').text('Advocate');
                                break;
                            }
                            case('infp-a') : {
                                $teamMember.find('.role').text('Diplomat');
                                $teamMember.find('.strategy').text('Confident Individualism');
                                $teamMember.find('.personality').text('Mediator');
                                break;
                            }
                            case('enfj-a') : {
                                $teamMember.find('.role').text('Diplomat');
                                $teamMember.find('.strategy').text('People Mastery');
                                $teamMember.find('.personality').text('Protagonist');
                                break;
                            }
                            case('enfp-a') : {
                                $teamMember.find('.role').text('Diplomat');
                                $teamMember.find('.strategy').text('People Mastery');
                                $teamMember.find('.personality').text('Campaigner');
                                break;
                            }
                            case('infj-t') : {
                                $teamMember.find('.role').text('Diplomat');
                                $teamMember.find('.strategy').text('Constant Improvement');
                                $teamMember.find('.personality').text('Advocate');
                                break;
                            }
                            case('infp-t') : {
                                $teamMember.find('.role').text('Diplomat');
                                $teamMember.find('.strategy').text('Constant Improvement');
                                $teamMember.find('.personality').text('Mediator');
                                break;
                            }
                            case('enfj-t') : {
                                $teamMember.find('.role').text('Diplomat');
                                $teamMember.find('.strategy').text('Social Engagement');
                                $teamMember.find('.personality').text('Protagonist');
                                break;
                            }
                            case('enfp-t') : {
                                $teamMember.find('.role').text('Diplomat');
                                $teamMember.find('.strategy').text('Social Engagement');
                                $teamMember.find('.personality').text('Campaigner');
                                break;
                            }

                            case('istj-a') : {
                                $teamMember.find('.role').text('Sentinel');
                                $teamMember.find('.strategy').text('Confident Individualism');
                                $teamMember.find('.personality').text('Logistician');
                                break;
                            }
                            case('isfj-a') : {
                                $teamMember.find('.role').text('Sentinel');
                                $teamMember.find('.strategy').text('Confident Individualism');
                                $teamMember.find('.personality').text('Defender');
                                break;
                            }
                            case('estj-a') : {
                                $teamMember.find('.role').text('Sentinel');
                                $teamMember.find('.strategy').text('People Mastery');
                                $teamMember.find('.personality').text('Executive');
                                break;
                            }
                            case('esfj-a') : {
                                $teamMember.find('.role').text('Sentinel');
                                $teamMember.find('.strategy').text('People Mastery');
                                $teamMember.find('.personality').text('Consul');
                                break;
                            }
                            case('istj-t') : {
                                $teamMember.find('.role').text('Sentinel');
                                $teamMember.find('.strategy').text('Constant Improvement');
                                $teamMember.find('.personality').text('Logistician');
                                break;
                            }
                            case('isfj-t') : {
                                $teamMember.find('.role').text('Sentinel');
                                $teamMember.find('.strategy').text('Constant Improvement');
                                $teamMember.find('.personality').text('Defender');
                                break;
                            }
                            case('estj-t') : {
                                $teamMember.find('.role').text('Sentinel');
                                $teamMember.find('.strategy').text('Social Engagement');
                                $teamMember.find('.personality').text('Executive');
                                break;
                            }
                            case('esfj-t') : {
                                $teamMember.find('.role').text('Sentinel');
                                $teamMember.find('.strategy').text('Social Engagement');
                                $teamMember.find('.personality').text('Consul');
                                break;
                            }

                            case('istp-a') : {
                                $teamMember.find('.role').text('Explorer');
                                $teamMember.find('.strategy').text('Confident Individualism');
                                $teamMember.find('.personality').text('Virtuoso');
                                break;
                            }
                            case('isfp-a') : {
                                $teamMember.find('.role').text('Explorer');
                                $teamMember.find('.strategy').text('Confident Individualism');
                                $teamMember.find('.personality').text('Adventurer');
                                break;
                            }
                            case('estp-a') : {
                                $teamMember.find('.role').text('Explorer');
                                $teamMember.find('.strategy').text('People Mastery');
                                $teamMember.find('.personality').text('Entrepreneur');
                                break;
                            }
                            case('esfp-a') : {
                                $teamMember.find('.role').text('Explorer');
                                $teamMember.find('.strategy').text('People Mastery');
                                $teamMember.find('.personality').text('Entertainer');
                                break;
                            }
                            case('istp-t') : {
                                $teamMember.find('.role').text('Explorer');
                                $teamMember.find('.strategy').text('Constant Improvement');
                                $teamMember.find('.personality').text('Virtuoso');
                                break;
                            }
                            case('isfp-t') : {
                                $teamMember.find('.role').text('Explorer');
                                $teamMember.find('.strategy').text('Constant Improvement');
                                $teamMember.find('.personality').text('Adventurer');
                                break;
                            }
                            case('estp-t') : {
                                $teamMember.find('.role').text('Explorer');
                                $teamMember.find('.strategy').text('Social Engagement');
                                $teamMember.find('.personality').text('Entrepreneur');
                                break;
                            }
                            case('esfp-t') : {
                                $teamMember.find('.role').text('Explorer');
                                $teamMember.find('.strategy').text('Social Engagement');
                                $teamMember.find('.personality').text('Entertainer');
                                break;
                            }
                        }

                        $teamMember.appendTo($teamIbox.find($('.team-members')));
                    })
                })
            })

            $('.btn-start-big-idea').click(function() {
                $('#new-big-idea-modal').modal('show');

                $(this).prop('disabled', true);

                var $challengeIbox = $(this).parents('.challenge-ibox');
                var $phaseIcon = $challengeIbox.find('.big-idea-icon');
                $phaseIcon.attr('src', 'img/Icones-CBL/Big-Idea.png');
                var $startButton = $challengeIbox.find('.btn-start-big-idea');
                $startButton.text('On');                    

                var challengeId = $challengeIbox.attr('challenge-id');
                selectedChallenge = challengesDict[challengeId];

                var activities = [];

                var ActivityStatement = Parse.Object.extend('ActivityStatement');
                var statement = new ActivityStatement();

                statement.set('text', 'What is your Big Idea for this challenge?');
                statement.set('cblClass', currentCBLClass);
                statement.set('cblSprint', currentCBLSprint);
                statement.set('isNewToolCard', false);
                statement.set('isNewTeam', false);
                statement.set('isBigIdea', true);
                statement.set('author', Parse.User.current());
                statement.set('activities', []);
                statement.set('cblChallenge', selectedChallenge);

                $progressMessage = $('#new-big-idea-modal').find('.new-challenge-progress-message');
                $progressMessage.text('Saving statement');
                return statement.save().then(function(s) {
                    statement = s;
                    var promise = Parse.Promise.as();
                    var totalActivities = students.length;
                    var numSavedEmptyActivities = 0;

                    var Activity = Parse.Object.extend('Activity');

                    _.each(students, function(student) {
                        var studentTeam;
                        _.each(teams, function(team) {
                            if (team.get('cblCycle').id == selectedChallenge.id) {
                                var members = team.get('members');
                                for (var i = 0; i < members.length; i++) {
                                    var member = members[i];
                                    if (member.id == student.id) {
                                        studentTeam = team;
                                        var activity = new Activity();
                                        activity.set('author', student);
                                        activity.set('isDone', false);
                                        activity.set('statement', s);
                                        activity.set('cblClass', currentCBLClass);
                                        activity.set('cblSprint', currentCBLSprint);
                                        activity.set('cblChallenge', selectedChallenge);
                                        activity.set('newTeam', studentTeam);

                                        $progressMessage.text('Saving activities...');
                                        promise = promise.then(function() {                        
                                            return activity.save().then(function(act) {
                                                numSavedEmptyActivities++;
                                                $('.progress-bar').css('width', (numSavedEmptyActivities/totalActivities)*100 + '%');
                                                activities.push(act);
                                            });
                                        })
                                        break;
                                    }
                                }
                            }
                        })
                    })
                    return promise;
                }).then(function() {
                    _.each(activities, function(activity) {
                        statement.addUnique('activities', activity);
                    })
                    $progressMessage.text('Adding activities to statement...');
                    return statement.save();
                }).then(function() {
                    $progressMessage.text('Updating challenge...');
                    selectedChallenge.set('onBigIdea', true);
                    return selectedChallenge.save();                    
                }).then(function() {
                    $('#new-big-idea-modal').modal('hide');
                })
            })
        }

    </script>

    <script type="text/javascript">
        var challengesDict = {};
        var selectedChallenge;

        $(function() {
            $btnSetup = $('#btn-setup').detach();

            var user = Parse.User.current();
            if (user && user.get('email') == 'cca2@cin.ufpe.br') {
                $btnSetup.prependTo('.file-manager');
                $('#btn-setup').click(function() {
                    setup();
                })
            }

            if (user) {
                currentUser = user;

                if (!currentUser.get('currentCBLClass')) {
                    user.logOut();
                    window.location = 'cbl_login_two_columns.html';
                }

                // var userQuery = new Parse.Query(Parse.User);
                // userQuery.include('currentCBLClass');
                // userQuery.include('currentCBLSprint.teams.members');
                // userQuery.get(currentUser.id).then(function(user) {
                //     teams = user.get('currentCBLSprint').get('teams');
                // })

                loadChallenges().then(function(challenges) {
                    _.each(challenges, function(challenge) {
                        challengesDict[challenge.id] = challenge;
                    })
                    displayChallenges(challenges);
                })

                var CBLSprint = Parse.Object.extend('CBLSprint');
                var cblSprintQuery = new Parse.Query(CBLSprint);
                cblSprintQuery.get(currentUser.get('currentCBLSprint').id).then(function(cblSprint) {
                    currentCBLSprint = cblSprint;
                    $('.cbl-sprint-name').text(currentCBLSprint.get('name'));
                })

                var CBLClass = Parse.Object.extend('CBLClass');
                var cblClassQuery = new Parse.Query(CBLClass);
                cblClassQuery.include('students');
                cblClassQuery.include('cblSprints.teams');
                cblClassQuery.get(currentUser.get('currentCBLClass').id).then(function(cblClass) {
                    currentCBLClass = cblClass;
                    var Team = Parse.Object.extend('Team');
                    var teamQuery = new Parse.Query(Team);
                    teamQuery.equalTo('cblClass', currentCBLClass);
                    teamQuery.include('members');
                    teamQuery.find().then(function(ts) {
                        teams = ts;
                        $('.total-teams').text(teams.length);
                        // displayChallenges();
                    })

                    students = currentCBLClass.get('students').sort(function(a, b){

                        if (!a) {
                            return 1;
                        }

                        a = a.get('name');
                        b = b.get('name');
                        if (a > b) {
                            return 1;
                        }else if (a < b) {
                            return -1;
                        }else {
                            return 0;
                        }
                    });

                    var studentsNames = [];

                    _.each(students, function(student) {
                        studentsDict[student.get('email')] = student;
                        studentsByNameDict[student.get('name')] = student;
                        studentsNames.push(student.get('name'));
                    })

                    var substringMatcher = function(strs) {
                      return function findMatches(q, cb) {
                        var matches, substringRegex;

                        // an array that will be populated with substring matches
                        matches = [];

                        // regex used to determine if a string contains the substring `q`
                        substrRegex = new RegExp(q, 'i');

                        // iterate through the pool of strings and for any string that
                        // contains the substring `q`, add it to the `matches` array
                        $.each(strs, function(i, str) {
                          if (substrRegex.test(str)) {
                            matches.push(str);
                          }
                        });

                        cb(matches);
                      };
                    };

                    $('.typeahead').typeahead({
                      hint: true,
                      highlight: true,
                      minLength: 1
                    },
                    {
                      name: 'studentsNames',
                      source: substringMatcher(studentsNames)
                    });

                    $('.typeahead').bind('typeahead:select', function(ev, suggestion){
                        var name = suggestion;
                        if (name != '') {
                            $(this).typeahead('val', '');                
                            var email = studentsByNameDict[name].get('email');
                            if (studentsDict[email]) {
                                var student = studentsDict[email];
                                var personality16 = student.get('personality16');
                                var personality16Img = getPersonalityImg(personality16);
                                var personality16Info = getPersolity16Info(personality16);

                                var $teamMemberRow = $newTeamMemberRowRef.clone();
                                if (student.get('photo')) {
                                    $teamMemberRow.find('.member-photo').attr('src',student.get('photo').url());
                                }
                                $teamMemberRow.find('.new-team-member-email').text(student.get('email'));
                                $teamMemberRow.find('.new-team-member-name').text(student.get('name'));
                                $teamMemberRow.find('.new-team-member-affiliation').text(student.get('affiliation'));
                                $teamMemberRow.find('.new-team-member-personality16-img').attr('src', personality16Img);
                                $teamMemberRow.find('.new-team-member-personality16-role').text(personality16Info['role']);
                                $teamMemberRow.find('.new-team-member-personality16-personality').text(personality16Info['personality']);
                                $teamMemberRow.find('.new-team-member-personality16-strategy').text(personality16Info['strategy']);
                                $teamMemberRow.find('.new-team-member-remove').click(function() {
                                    $(this).parents('tr').remove();
                                })
                                $teamMemberRow.appendTo('.new-team-table').find('tbody');
                            }
                        }
                    })
                    $('.cbl-class-name').text(cblClass.get('name'));                    
                })
                $('.user-name').text(user.get('name'));
            }else {
                window.location = "cbl_login_two_columns.html";
            }
        })

        $('#btn-submit-new-cbl-cycle').click(function() {
            var name = $(this).parents('#new-challenge-modal').find('#input-challenge-name').val().trim();

            var Challenge = Parse.Object.extend('Challenge');
            var newChallenge = new Challenge();
            newChallenge.set('name', name);
            newChallenge.set('cblClass', currentCBLClass);
            newChallenge.set('cblSprint', currentCBLSprint);
            newChallenge.set('teams', []);
            newChallenge.set('onBigIdea', false);
            newChallenge.set('bigIdeas', []);
            newChallenge.save().then(function(challenge) {
                var activities = [];

                var ActivityStatement = Parse.Object.extend('ActivityStatement');
                var statement = new ActivityStatement();

                statement.set('text', 'Create a new team for the challenge ' + name);
                statement.set('cblClass', currentCBLClass);
                statement.set('cblSprint', currentCBLSprint);
                statement.set('isNewToolCard', false);
                statement.set('isNewTeam', true);
                statement.set('author', Parse.User.current());
                statement.set('activities', []);
                statement.set('cblChallenge', challenge);
                return statement.save().then(function(s) {
                    var promise = Parse.Promise.as();
                    var totalActivities = students.length;
                    var numSavedEmptyActivities = 0;
                    _.each(students, function(student) {
                        var Activity = Parse.Object.extend('Activity');
                        var activity = new Activity();
                        activity.set('author', student);
                        activity.set('isDone', false);
                        activity.set('statement', s);
                        activity.set('cblClass', currentCBLClass);
                        activity.set('cblSprint', currentCBLSprint);
                        promise = promise.then(function() {                        
                            return activity.save().then(function(act) {
                                numSavedEmptyActivities++;
                                $('.progress-bar').css('width', (numSavedEmptyActivities/totalActivities)*100 + '%');
                                activities.push(act);
                                statement.addUnique('activities', act);
                            });
                        })
                    })
                    return promise;
                }).then(function() {
                    statement.save();
                    $('#new-challenge-modal').modal('hide');
                    $('.progress-bar').css('width', '0%');
                })

            })
        })



        $('#link-logout').click(function() {
            Parse.User.logOut();
        })

        $('#menu-logout').click(function() {
            Parse.User.logOut();
        })

        $('#btn-new-team').click(function() {
            $('#new-challenge-modal').modal('show');
            $('#team-name').val('');
            $('#new-team-member-email').val('');
            $('.twitter-typeahead').find('pre').text('');
            $('#team-name').focus();
        })

        $('#btn-new-big-idea').click(function() {
            $('#new-big-idea-modal').modal('show');
            $('#input-big-idea').focus();
        })
        
    </script>

    <!-- iCheck -->
    <script src="js/plugins/iCheck/icheck.min.js"></script>
    <script>
        $(document).ready(function(){
            $('.i-checks').iCheck({
                checkboxClass: 'icheckbox_square-green',
                radioClass: 'iradio_square-green',
            });

            var elem = document.querySelector('.js-switch');
            var switchery = new Switchery(elem, { color: '#1AB394' });

        });
    </script>
</body>

</html>
