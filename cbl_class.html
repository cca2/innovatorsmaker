<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>INNOVATORSMAKER | Reflections</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/plugins/iCheck/custom.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

    <style type="text/css">
        #page-wrapper {
            margin: 0;
        }

        .wrapper-content {
            padding: 5px;
        }

        .widget {
            margin: 0;
        }

        .mailbox-header {
            padding-top: 10px;
        }

        .widget.navy-bg {
            border: solid 1px;
            color: #1ab394;
            background: #fff;
        }

        .mailbox-content {
            padding: 0;
        }

        .reflections-items-body {
            padding: 0;
        }

        .social-avatar {
            padding: 0;
            padding-bottom: 0;
        }

        .student-reflection-item p {
            margin-top: 10px;
            margin-bottom: 0;
        }

        .btn-student-profile-show {
            width: 68px;
        }

        .navbar-top-links li a {
            min-height: 30px;
        }

        .nav {
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .nav > li > a {
            padding: 10px 0;
            color: #676a6c;            
        }

        .nav > li.active {
            border-left: none;
        }

        .nav > li.active > a {
            color: #676a6c;            
        }

        .nav-second-level li a {
            padding: 7px 10px 7px 10px;
        }

        .nav > li.active {
            background: #e7eaec;
            color: #19aa8d;
        }

        .btn-show-reflections {
            width: 60px;
        }

        .btn-propose {
            width: 100%;
        }

        .separator-reflection-timeline-item > .row > .content {
            min-height: 30px;
        }

        .timeline-item .date {
            width: 70px;
        }

        .reflection-media-type-form {
            padding: 10px;
            height: 40px;
        }

        .reflection-media-type-form label {
            margin: 0;
        }

        .new-reflection-modal-body {
            padding: 0;
        }

        .new-reflection-textarea {
            width: 100%;
            padding: 10px;
            border: none;
        }

        .personality-img {
            width: 60px;
        }

        .student-pending-reflections-row > td {
            position: relative;
        }

        .student-email {
            position: absolute;
            top: 22px;
            left: 8px;
        }

        .num-student-pending-reflections {
            font-size: 20px;
            font-weight: 700;
        }

        img.member-photo.img-circle {
            height: 60px;
            width: 60px;
        }

        .team-name-p {
            color: #fff;
            position: relative;
            padding: 10px;
            background: rgba(0,0,0,0.42);
            margin: 0;            
        }

        .team-members {
            margin: 0;
        }

        .team-members img.img-circle {
            margin-top: 15px;
            width: 80px;
            height: 80px;
        }                        

    </style>
</head>

<body>

    <div id="wrapper">
        <div id="page-wrapper" class="gray-bg">
            <div class="row border-bottom">
                <nav class="navbar navbar-static-top white-bg" role="navigation" style="margin-bottom: 0">
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <span class="m-r-sm text-muted welcome-message"><span class="cbl-class-name"></span></span>
                        </li>
                        <li>
                            <a data-toggle="dropdown" class="dropdown-toggle" href="#" aria-expanded="false">
                             <span class="text-muted text-xs block"><span class="user-name"></span> <b class="caret"></b></span> </span> 
                            </a>
                            <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                <!-- <li><a href="profile.html">Profile</a></li> -->
                                <!-- <li><a href="contacts.html">Contacts</a></li> -->
                                <!-- <li><a href="mailbox.html">Mailbox</a></li> -->
                                <li><a id="menu-teams" href="cbl_teams.html">Challenges</a></li>
                                <li><a id="menu-manage-class" href="cbl_manage_class.html">16 Personalities</a></li>
                                <!-- <li class="divider"></li> -->
                                <li><a id="menu-logout" href="cbl_login_two_columns.html">Logout</a></li>
                            </ul>                            
                        </li>
                    </ul>
                </nav>
            </div>

            <div class="wrapper wrapper-content">
                <div class="row">
                    <div class="col-lg-2">
                        <div class="ibox float-e-margins">
                            <div class="ibox-content mailbox-content">
                                <div class="file-manager">
                                    <!-- <a id="btn-setup" type="button" class="btn btn-danger" href="#">setup</a> -->
                                    <div class="widget style1 navy-bg">
                                        <div class="row">
                                            <div class="col-xs-12 text-center">
                                                <h3 class="cbl-sprint-name font-bold">Sprint#0</h3>
                                            </div>
                                        </div>
                                    </div>                                    
                                    <div class="space-25"></div>
                                    <ul class="nav metismenu" id="side-menu">
                                        <li class>
                                            <a href="#"><i class="fa fa-th-large"></i> <span class="nav-label">Classes</span> <span class="fa arrow"></span></a>
                                            <ul class="nav-classes-second-level nav nav-second-level collapse">
                                                <li class="nav-cbl-class-name"><a href="#" cbl-class-id="">Bepid 2016</a></li>
                                            </ul>
                                        </li>
                                        <li class>
                                            <a href="#"><i class="fa fa-th-large"></i> <span class="nav-label">Sprints</span> <span class="fa arrow"></span></a>
                                            <ul class="nav-sprints-second-level nav nav-second-level collapse">
                                                <li class="nav-cbl-sprint-name"><a href="#" cbl-sprint-id="">Sprint#0</a></li>
                                            </ul>
                                        </li>
                                    </ul>                                    
                                    <h5>REFLECTIONS</h5>
                                    <ul class="folder-list m-b-md" style="padding: 0">
                                        <li><a href="#" class="menu-show-students-reflections"> <i class="fa fa-inbox "></i>  Students<span class="label label-primary pull-right"><span class="total-done-students-reflections">0</span>/<span class="total-students-reflections">0</span></span> </a></li>
                                        <li><a href="#" class="menu-show-teachers-reflections"> <i class="fa fa-envelope-o"></i> Teachers<span class="label label-primary pull-right"><span class="total-teachers-reflections">0</span></a></li>
                                        <li><a href="#" class="menu-show-reflections-statements"> <i class="fa fa-certificate"></i> Proposed<span class="label label-primary pull-right"><span class="total-statement-reflections">0</span></a></li>
                                        <li><a href="#" class="menu-show-students-list"> <i class="fa fa-certificate"></i> Pending<span class="label label-danger pull-right"><span class="total-pending-reflections">0</span></a></li>
                                    </ul>
                                    <a id="btn-new-reflection-statement" type="button" class="btn btn-primary btn-propose" data-toggle="modal" data-target="#new-reflection-statement-modal" class="btn btn-block btn-primary compose-mail" href="#">propose reflection</a>

                                    <a id="btn-new-student-content" type="button" class="btn btn-primary btn-propose" data-toggle="modal" data-target="#new-student-content-modal" class="btn btn-block btn-primary compose-mail" href="#">propose activity</a>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-10 reflections-panel">
                        <div class="students-list students-info-list animated fadeInRight">
                            <div class="mail-box-header">
                                <h2>
                                    Students Pending Reflections
                                    <span class="ratio-students-reflections label label-danger pull-right"><span class="total-pending-reflections">0</span>/<span class="total-students-reflections">0</span></span>
                                </h2>
                            </div>
                            <div class="mail-box client-list">
                                <table class="table">
                                    <tbody class="students-pending-reflections-table-body">
                                        <tr class="student-pending-reflections-row">
                                            <td class="client-avatar"><img alt="image" src="img/a2.jpg"></td>
                                            <td><a data-toggle="tab" href="#contact-1" class="student-name client-link">Anthony Jackson</a>
                                            <small class="student-email"></small></td>
                                            <td><span class="affiliation-info">Bepid 2016</span></td>
                                            <td><img class="personality16-img" src="img/esfj.png" style="height: 30px;"></td>
                                            <td class="role">NONE</td>
                                            <td class="personality">NONE</td>
                                            <td class="strategy">NONE</td>
                                            <td class="num-student-pending-reflections client-status"><span class="label label-danger pull-right">0</span></td>
                                        </tr>
                                    </tbody>                        
                                </table>
                            </div>                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="footer">
                <div class="pull-right">10GB of <strong>250GB</strong> Free.</div>
                <div>
                    <strong>Copyright</strong> Example Company &copy; 2014-2015
                </div>
            </div>
        </div>

        <div class="modal inmodal" id="new-teacher-reflection-modal" tabindex="-1" role="dialog" aria-hidden="true" student-reflection-statement-id="" teacher-reflection-statement-id="P34QuDoziO">
            <div class="modal-dialog">
                <div class="modal-content animated">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Teacher Reflection</h4>
                        <small class="font-bold">I have learned from these reflections that...</small>
                    </div>
                    <div class="new-reflection-modal-body modal-body">
                        <textarea class="new-reflection-textarea" rows="10"placeholder="in this activity..."></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                        <button id="btn-save-new-teacher-reflection" type="button" class="btn btn-primary">send reflection</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal inmodal" id="new-reflection-statement-modal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">New Reflection</h4>
                        <small class="font-bold">Propose a new reflection to your class</small>
                    </div>
                    <div class="new-reflection-modal-body modal-body">
                        <textarea class="new-reflection-statement-textarea new-reflection-textarea" rows="5" placeholder="in this activity..."></textarea>
                    </div>
                    <div class="modal-footer">
                        <div class="progress progress-small">
                            <div style="width: 0%;" class="progress-bar"></div>
                        </div>
                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                        <button id="btn-save-new-reflection-statement" type="button" class="btn btn-primary">Save reflection</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal inmodal" id="new-reflection-statement-modal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content animated">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">New Reflection</h4>
                        <small class="font-bold">Propose a new reflection to your class</small>
                    </div>
                    <div class="new-reflection-modal-body modal-body">
                        <textarea class="new-reflection-statement-textarea new-reflection-textarea" rows="5" placeholder="in this activity..."></textarea>
                    </div>
                    <div class="modal-footer">
                        <div class="progress progress-small">
                            <div style="width: 0%;" class="progress-bar"></div>
                        </div>
                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                        <button id="btn-save-new-reflection-statement" type="button" class="btn btn-primary">Save reflection</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-2.1.1.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>

    <!-- Peity -->
    <script src="js/plugins/peity/jquery.peity.min.js"></script>

    <!-- Peity -->
    <script src="js/demo/peity-demo.js"></script>

    <script type="text/javascript" src="js/underscore-1.8.3.js"></script>

    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
    <script type="text/javascript">
        Parse.initialize("YALt9tjcUpW61Hz5aIPYbehm9uCgh5NXXRVM18T6", "5wwhJ6hfqu8cG4s6jMKMQWrmImiQKDTE9trvgL6x");
    </script>

    <script type="text/javascript" src="js/innovatorsmaker-cbl.js"></script>

    <script type="text/javascript">
        var totalNumDoneStudentsReflections = 0;
        var totalStudentsReflections = 0;
        var totalTeachersReflections = 0;
        var totalReflectionStatements = 0;

        var $pendingNewTeamTimelineItemRef = $('.pending-new-team-timeline-item').detach();
        var $reflectionStatementRef = $('.reflection-row').detach();
        var $reflectionsPerStatementRef = $('.reflections-per-statement-list').detach();
        var $sprintTimelineSeparatorRef = $('.separator-reflection-timeline-item').detach();
        var $videoReflectionTimelineItemRef = $('.video-reflection-timeline-item').detach();
        var $teamTimelineItemRef = $('.team-timeline-item').detach();
        var $teamMemberRef = $teamTimelineItemRef.find('.team-member').detach();
        var $reflectionTimelineItemRef = $('.reflection-timeline-item').detach();
        var $pendingBigIdeaTimelineItemRef = $('.pending-big-idea-item').detach();
        var $bigIdeaTimelineItemRef = $('.big-idea-item').detach();

        $studentPendingReflectionsRowRef = $('.student-pending-reflections-row').detach();
        $teacherReflectionItemRef = $('.teacher-reflection-item').detach();

        $navCBLClassRef = $('.nav-cbl-class-name').detach();
        $navCBLSprintRef = $('.nav-cbl-sprint-name').detach();


        function setup() {
            var CBLSprint = Parse.Object.extend('CBLSprint')
            sprint = new CBLSprint()
            sprint.set('name', 'Sprint#0')
            sprint.set('isActive', true)
            sprint.set('cblClass', currentCBLClass)
            sprint.save().then(function(s) {
                currentCBLClass.set('currentCBLSprint', s);
                currentCBLClass.addUnique('cblSprints', s)
                return currentCBLClass.save();
            }).then(function() {
                alert(0)
            })
        }

        function loadStudents() {

        }

        function displayStudentsList() {
            $('.students-info-list').addClass('hide');
            $('.students-list').removeClass('hide');

            $('.students-pending-reflections-table-body').empty();

            _.each(students, function(student) {
                var personality16 = student.get('personality16');

                if (personality16 && personality16 != '') {
                    var personalityPrefix = personality16.substring(0,4);
                    // if (studentsPendencies[student.id].length > 0) {
                        $studentPendingReflectionsRow = $studentPendingReflectionsRowRef.clone();
                        var $personalityImg = $studentPendingReflectionsRow.find('.personality16-img');
                        $personalityImg.attr('src', 'img/' + personalityPrefix + '.png');

                        switch(personality16) {
                            case('none') : {
                                break;
                            }
                            case('intj-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Analyst');
                                $studentPendingReflectionsRow.find('.strategy').text('Confident Individualism');
                                $studentPendingReflectionsRow.find('.personality').text('Architect');
                                break;
                            }
                            case('intp-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Analyst');
                                $studentPendingReflectionsRow.find('.strategy').text('Confident Individualism');
                                $studentPendingReflectionsRow.find('.personality').text('Logician');
                                break;
                            }
                            case('entj-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Analyst');
                                $studentPendingReflectionsRow.find('.strategy').text('People Mastery');
                                $studentPendingReflectionsRow.find('.personality').text('Commander');
                                break;
                            }
                            case('entp-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Analyst');
                                $studentPendingReflectionsRow.find('.strategy').text('People Mastery');
                                $studentPendingReflectionsRow.find('.personality').text('Debater');
                                break;
                            }
                            case('intj-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Analyst');
                                $studentPendingReflectionsRow.find('.strategy').text('Constant Improvement');
                                $studentPendingReflectionsRow.find('.personality').text('Architect');
                                break;
                            }
                            case('intp-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Analyst');
                                $studentPendingReflectionsRow.find('.strategy').text('Constant Improvement');
                                $studentPendingReflectionsRow.find('.personality').text('Logician');
                                break;
                            }
                            case('entj-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Analyst');
                                $studentPendingReflectionsRow.find('.strategy').text('Social Engagement');
                                $studentPendingReflectionsRow.find('.personality').text('Commander');
                                break;
                            }
                            case('entp-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Analyst');
                                $studentPendingReflectionsRow.find('.strategy').text('Social Engagement');
                                $studentPendingReflectionsRow.find('.personality').text('Debater');
                                break;
                            }

                            case('infj-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Diplomat');
                                $studentPendingReflectionsRow.find('.strategy').text('Confident Individualism');
                                $studentPendingReflectionsRow.find('.personality').text('Advocate');
                                break;
                            }
                            case('infp-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Diplomat');
                                $studentPendingReflectionsRow.find('.strategy').text('Confident Individualism');
                                $studentPendingReflectionsRow.find('.personality').text('Mediator');
                                break;
                            }
                            case('enfj-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Diplomat');
                                $studentPendingReflectionsRow.find('.strategy').text('People Mastery');
                                $studentPendingReflectionsRow.find('.personality').text('Protagonist');
                                break;
                            }
                            case('enfp-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Diplomat');
                                $studentPendingReflectionsRow.find('.strategy').text('People Mastery');
                                $studentPendingReflectionsRow.find('.personality').text('Campaigner');
                                break;
                            }
                            case('infj-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Diplomat');
                                $studentPendingReflectionsRow.find('.strategy').text('Constant Improvement');
                                $studentPendingReflectionsRow.find('.personality').text('Advocate');
                                break;
                            }
                            case('infp-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Diplomat');
                                $studentPendingReflectionsRow.find('.strategy').text('Constant Improvement');
                                $studentPendingReflectionsRow.find('.personality').text('Mediator');
                                break;
                            }
                            case('enfj-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Diplomat');
                                $studentPendingReflectionsRow.find('.strategy').text('Social Engagement');
                                $studentPendingReflectionsRow.find('.personality').text('Protagonist');
                                break;
                            }
                            case('enfp-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Diplomat');
                                $studentPendingReflectionsRow.find('.strategy').text('Social Engagement');
                                $studentPendingReflectionsRow.find('.personality').text('Campaigner');
                                break;
                            }

                            case('istj-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Sentinel');
                                $studentPendingReflectionsRow.find('.strategy').text('Confident Individualism');
                                $studentPendingReflectionsRow.find('.personality').text('Logistician');
                                break;
                            }
                            case('isfj-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Sentinel');
                                $studentPendingReflectionsRow.find('.strategy').text('Confident Individualism');
                                $studentPendingReflectionsRow.find('.personality').text('Defender');
                                break;
                            }
                            case('estj-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Sentinel');
                                $studentPendingReflectionsRow.find('.strategy').text('People Mastery');
                                $studentPendingReflectionsRow.find('.personality').text('Executive');
                                break;
                            }
                            case('esfj-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Sentinel');
                                $studentPendingReflectionsRow.find('.strategy').text('People Mastery');
                                $studentPendingReflectionsRow.find('.personality').text('Consul');
                                break;
                            }
                            case('istj-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Sentinel');
                                $studentPendingReflectionsRow.find('.strategy').text('Constant Improvement');
                                $studentPendingReflectionsRow.find('.personality').text('Logistician');
                                break;
                            }
                            case('isfj-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Sentinel');
                                $studentPendingReflectionsRow.find('.strategy').text('Constant Improvement');
                                $studentPendingReflectionsRow.find('.personality').text('Defender');
                                break;
                            }
                            case('estj-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Sentinel');
                                $studentPendingReflectionsRow.find('.strategy').text('Social Engagement');
                                $studentPendingReflectionsRow.find('.personality').text('Executive');
                                break;
                            }
                            case('esfj-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Sentinel');
                                $studentPendingReflectionsRow.find('.strategy').text('Social Engagement');
                                $studentPendingReflectionsRow.find('.personality').text('Consul');
                                break;
                            }

                            case('istp-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Explorer');
                                $studentPendingReflectionsRow.find('.strategy').text('Confident Individualism');
                                $studentPendingReflectionsRow.find('.personality').text('Virtuoso');
                                break;
                            }
                            case('isfp-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Explorer');
                                $studentPendingReflectionsRow.find('.strategy').text('Confident Individualism');
                                $studentPendingReflectionsRow.find('.personality').text('Adventurer');
                                break;
                            }
                            case('estp-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Explorer');
                                $studentPendingReflectionsRow.find('.strategy').text('People Mastery');
                                $studentPendingReflectionsRow.find('.personality').text('Entrepreneur');
                                break;
                            }
                            case('esfp-a') : {
                                $studentPendingReflectionsRow.find('.role').text('Explorer');
                                $studentPendingReflectionsRow.find('.strategy').text('People Mastery');
                                $studentPendingReflectionsRow.find('.personality').text('Entertainer');
                                break;
                            }
                            case('istp-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Explorer');
                                $studentPendingReflectionsRow.find('.strategy').text('Constant Improvement');
                                $studentPendingReflectionsRow.find('.personality').text('Virtuoso');
                                break;
                            }
                            case('isfp-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Explorer');
                                $studentPendingReflectionsRow.find('.strategy').text('Constant Improvement');
                                $studentPendingReflectionsRow.find('.personality').text('Adventurer');
                                break;
                            }
                            case('estp-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Explorer');
                                $studentPendingReflectionsRow.find('.strategy').text('Social Engagement');
                                $studentPendingReflectionsRow.find('.personality').text('Entrepreneur');
                                break;
                            }
                            case('esfp-t') : {
                                $studentPendingReflectionsRow.find('.role').text('Explorer');
                                $studentPendingReflectionsRow.find('.strategy').text('Social Engagement');
                                $studentPendingReflectionsRow.find('.personality').text('Entertainer');
                                break;
                            }
                        }

                    // }                        
                }else {
                    $studentPendingReflectionsRow = $studentPendingReflectionsRowRef.clone();
                    var $personalityImg = $studentPendingReflectionsRow.find('.personality16-img');
                    $personalityImg.attr('src', 'img/' + personalityPrefix + '.png');

                    $studentPendingReflectionsRow.find('.role').text('NOT DEFINED');
                    $studentPendingReflectionsRow.find('.strategy').text('NOT DEFINED');
                    $studentPendingReflectionsRow.find('.personality').text('NOT DEFINED');
                }

                if (student.get('photo')) {
                    $studentPendingReflectionsRow.find('.client-avatar').find('img').attr('src', student.get('photo').url());
                }
                $studentPendingReflectionsRow.attr('student-id', student.id);
                $studentPendingReflectionsRow.find('.student-name').text(student.get('name'));
                $studentPendingReflectionsRow.find('.affiliation-info').text(student.get('affiliation'));
                $studentPendingReflectionsRow.find('.student-email').text(student.get('email'));
                $studentPendingReflectionsRow.find('.num-student-pending-reflections').text(studentsPendencies[student.id].length);
                $studentPendingReflectionsRow.appendTo('.students-pending-reflections-table-body');                            
            })

            $('.student-name').click(function() {
                var studentId = $(this).parents('.student-pending-reflections-row').attr('student-id');
                displayStudentProfile(studentId);
            })                
        }

        function displayStudentProfile(studentId) {
            $('.students-info-list').addClass('hide');
            $('.student-profile').removeClass('hide');

            for (var i = 0; i < students.length; i++) {
                if (students[i].id == studentId) {
                    $('.student-profile-name').text(students[i].get('name'));
                    var personality16Img = getPersonality16Img(students[i].get('personality16'));
                    $('.personality-img').attr('src', personality16Img);
                    var personality16 = getPersonality16Info(students[i].get('personality16'));
                    $('.student-role').text(personality16['role']);
                    $('.student-profile').text(personality16['profile']);
                    $('.student-strategy').text(personality16['strategy']);
                    $('.student-profile-affiliation').text(students[i].get('affiliation'));
                    loadTimeline(students[i], currentCBLClass).then(function(timeline) {
                        displayTimeline(timeline);
                    });
                    if (students[i].get('photo')) {
                        var studentProfilePhoto = students[i].get('photo').url();
                        $('.student-profile-img').attr('src', studentProfilePhoto);
                    }
                    break;
                }
            }            
        }

    </script>

    <script type="text/javascript">
        var students = [];

        var activitiesDict = {};

        var selectedActivity;

        var cblClassesDict = {};
        var cblSprintsDict = {};
        var currentTeacherReflection;
        var currentCBLClass;
        var currentCBLSprint;
        var currentUser;

        var newActivityStatementText;

        $(function() {
            var user = Parse.User.current();
            if (user && user.get('email') == 'cca2@cin.ufpe.br') {
                $btnSetup.prependTo('.file-manager');
                $('#btn-setup').click(function() {
                    setup();
                })
            }

            if (user) {
                currentUser = user;

                if (!currentUser.get('currentCBLClass')) {
                    user.logOut();
                    window.location = 'cbl_login_two_columns.html';
                }

                var userQuery = new Parse.Query(Parse.User);
                userQuery.include('cblClasses');
                userQuery.get(currentUser.id).then(function(user) {
                    currentCBLClass = user.get('currentCBLClass');
                    currentCBLSprint = user.get('currentCBLSprint');
                    cblClasses = user.get('cblClasses');
                    _.each(cblClasses, function(cblClass) {
                        cblClassesDict[cblClass.id] = cblClass;
                        $cblClass = $navCBLClassRef.clone();
                        $cblClass.find('a').text(cblClass.get('name'));
                        $cblClass.find('a').attr('cbl-class-id', cblClass.id);
                        $cblClass.appendTo($('.nav-classes-second-level'));                        
                    })

                    $('.nav-cbl-class-name > a').click(function(){
                        var id = $(this).attr('cbl-class-id');
                        currentUser.set('currentCBLClass', cblClassesDict[id]);
                        currentUser.set('currentCBLSprint', cblClassesDict[id].get('cblSprints')[0]);
                        currentUser.save().then(function() {
                            window.location = 'cbl_reflections_box.html';
                        })
                    })
                })

                var CBLClass = Parse.Object.extend('CBLClass');
                var cblClassQuery = new Parse.Query(CBLClass);
                cblClassQuery.include('students');
                cblClassQuery.include('cblSprints.teams.members');
                cblClassQuery.get(currentUser.get('currentCBLClass').id).then(function(cblClass) {
                    currentCBLClass = cblClass;

                    students = currentCBLClass.get('students').sort(function(a, b){

                        if (!a) {
                            return 1;
                        }

                        a = a.get('name');
                        b = b.get('name');
                        if (a > b) {
                            return 1;
                        }else if (a < b) {
                            return -1;
                        }else {
                            return 0;
                        }
                    });

                    var sprints = currentCBLClass.get('cblSprints');
                    _.each(sprints, function(cblSprint) {
                        cblSprintsDict[cblSprint.id] = cblSprint;
                        $cblSprint = $navCBLSprintRef.clone();
                        $cblSprint.find('a').text(cblSprint.get('name'));
                        $cblSprint.find('a').attr('cbl-sprint-id', cblSprint.id);
                        $cblSprint.appendTo($('.nav-sprints-second-level'));                        
                    })

                    $('.nav-cbl-sprint-name > a').click(function(){
                        var id = $(this).attr('cbl-sprint-id');
                        currentUser.set('currentCBLSprint', cblSprintsDict[id]);
                        currentUser.save().then(function() {
                            window.location = 'cbl_reflections_box.html';
                        })
                    })

                    teachers = currentCBLClass.get('teachers');
                    $('.cbl-class-name').text(cblClass.get('name'));

                    $('#menu-activity-team').click(function() {
                        var $modal = $('#propose-new-team-modal');
                        $modal.find('.new-team-proposal-textarea').val('');
                        $('#propose-new-team-modal').modal('show');
                        $modal.find('.new-team-proposal-textarea').focus();
                    })
                })

                var CBLSprint = Parse.Object.extend('CBLSprint');
                var cblSprintQuery = new Parse.Query(CBLSprint);
                cblSprintQuery.get(currentUser.get('currentCBLSprint').id).then(function(cblSprint) {
                    currentCBLSprint = cblSprint;
                    $('.cbl-sprint-name').text(cblSprint.get('name'));

                    var ReflectionStatement = Parse.Object.extend("ReflectionStatement");
                    var query = new Parse.Query(ReflectionStatement);
                    query.include('author');
                    query.equalTo('cblSprint', currentCBLSprint);
                    query.equalTo('isStudent', true);
                    query.descending('createdAt');
                    query.include('reflections.author');
                    query.include('teachersReflections.author');
                    query.find().then(function(statements) {
                        displayReflectionStatements(statements);

                        for (var i = 0; i < statements.length; i++) {
                            displayReflectionsPerStatement(statements[i]);
                        }

                        $('.link-student-reflection-author').click(function() {
                            var studentId = $(this).parents('.student-reflection-item').attr('student-id');
                            displayStudentProfile(studentId);
                        })

                        $('.btn-student-profile-show-pending-reflections').click(function() {
                            $('.reflection-timeline-item').addClass('hide');
                            $('.pending-reflection-timeline-item').removeClass('hide');
                        })

                        $('.btn-student-profile-show-done-reflections').click(function() {
                            $('.reflection-timeline-item').removeClass('hide');
                            $('.pending-reflection-timeline-item').addClass('hide');
                        })

                        $('.btn-student-profile-show-all-reflections').click(function() {
                            $('.reflection-timeline-item').removeClass('hide');
                        })

                        $('.btn-show-all-reflections').click(function() {
                            $reflectionsPerStatement = $(this).parents('.reflections-per-statement-list');
                            $reflectionsItems = $reflectionsPerStatement.find('.reflection-item');
                            $reflectionsItems.removeClass('hide');
                        })

                        $('.menu-show-students-reflections').click(function() {
                            displayStudentsReflectionsLists();
                        })

                        $('.menu-show-reflections-statements').click(function() {
                            displayReflectionStatementsList();
                        })

                        $('.menu-show-students-list').click(function() {
                            displayStudentsList();
                        })

                        $('.menu-show-teachers-reflections').click(function() {
                            displayTeachersReflectionsPerStatement();
                        })                        

                        $('.btn-show-done-reflections').click(function() {
                            $reflectionsPerStatement = $(this).parents('.reflections-per-statement-list');
                            $reflectionsItems = $reflectionsPerStatement.find('.reflection-item');
                            $teachersReflectionsItems = $reflectionsPerStatement.find('.teacher-reflection-item');
                            $pendingReflectionsItems = $reflectionsPerStatement.find('.reflection-item.reflection-pending');
                            $reflectionsItems.removeClass('hide');
                            $teachersReflectionsItems.addClass('hide');
                            $pendingReflectionsItems.addClass('hide');
                        })            

                        $('.btn-show-teachers-reflections').click(function() {
                            $reflectionsPerStatement = $(this).parents('.reflections-per-statement-list');
                            $reflectionsItems = $reflectionsPerStatement.find('.reflection-item');
                            $teachersReflectionsItems = $reflectionsPerStatement.find('.teacher-reflection-item');
                            $reflectionsItems.addClass('hide');
                            $teachersReflectionsItems.removeClass('hide');
                        })            

                        $('.btn-show-pending-reflections').click(function() {
                            $reflectionsPerStatement = $(this).parents('.reflections-per-statement-list');
                            $reflectionsItems = $reflectionsPerStatement.find('.reflection-item');
                            $pendingReflectionsItems = $reflectionsPerStatement.find('.reflection-item.reflection-pending');
                            $reflectionsItems.addClass('hide');
                            $pendingReflectionsItems.removeClass('hide');
                        })

                        // updateReflectionsMenu(statements);
                    })
                // })

                })

                $('.user-name').text(user.get('name'));
            }else {
                window.location = "cbl_login_two_columns.html";
            }
        })


        $('#link-logout').click(function() {
            Parse.User.logOut();
        })

        $('#menu-logout').click(function() {
            Parse.User.logOut();
        })
        
    </script>

    <!-- iCheck -->
    <script src="js/plugins/iCheck/icheck.min.js"></script>
    <script>
        $(document).ready(function(){
            $('.i-checks').iCheck({
                checkboxClass: 'icheckbox_square-green',
                radioClass: 'iradio_square-green',
            });
        });
    </script>
</body>

</html>
